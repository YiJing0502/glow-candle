import{a as M,m as I,M as q,_ as U,o as a,c as d,b as e,d as i,w as T,t as r,f as _,F as k,r as x,C as S,A as F,D as j,e as b,g,h as R}from"./index-nBPxgtNM.js";import{t as B}from"./timeStore-fFOOry2_.js";import{t as L}from"./toastsStore-e8baNn0w.js";import{P as J}from"./PageBtn-eqC-hrqB.js";import{s as H}from"./stringStore--FNRRdIT.js";import{T as z}from"./TwoTabs-DPFg0kQ3.js";import{D as G,S as K}from"./StatusMessage-e6On4WC9.js";var Q={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:W,VITE_API_PATH:X}=Q,Y={data(){return{inEditOrderMode:!1,updatedShowData:{},showCreateAt:"",showPaidDate:"",showProductsArray:[],showOrderMessage:[],originalShowData:{},tabs:[{label:"訂單資訊"},{label:"訂購資訊"}]}},props:["showData"],emits:["order-updated"],components:{TwoTabs:z},methods:{putOrder(){const l=JSON.parse(JSON.stringify(this.updatedShowData)),o=Object.keys(l.products);let u=0;o.forEach(t=>{const n=l.products[t],p=n.product.price*n.qty,h={id:n.id,product_id:n.product_id,total:n.product.price*n.qty,final_total:p,qty:n.qty,product:n.product};n.coupon&&(h.final_total=Number.parseInt(p*n.coupon.percent/100,10),h.coupon=n.coupon),u+=h.final_total,l.products[t]=h}),l.total=u,l.paid_date===void 0&&l.is_paid===!0&&(l.paid_date=this.dayToTimestamp10Code(this.currentDate));const v=`${W}/v2/api/${X}/admin/order/${l.id}`;this.$http.put(v,{data:l}).then(t=>{this.hideModal(),this.$emit("order-updated"),this.inEditOrderMode=!1,this.handleServerResponse(!0,t.data.message)}).catch(t=>{this.handleServerResponse(!1,t.response.data.message)})},editOrder(){this.originalShowData=JSON.parse(JSON.stringify(this.updatedShowData)),this.inEditOrderMode=!0},cancelChangeOrder(){this.updatedShowData=this.originalShowData,this.inEditOrderMode=!1},isPhone(l){return/^(09)[0-9]{8}$/.test(l)?!0:"請輸入正確的行動電話號碼"},openModal(){this.modal.show()},hideModal(){this.modal.hide()},handleServerResponse(l,o){const u=l?"bg-deep-gray":"bg-main-spec";this.pushToast({title:o,style:u})},...M(B,["dayToTimestamp10Code","timestamp10CodeToDay"]),...M(H,["splitStringByNewline"]),...M(L,["pushToast"])},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData)),this.showCreateAt=this.timestamp10CodeToDay(this.updatedShowData.create_at),this.showPaidDate=this.updatedShowData.is_paid?this.timestamp10CodeToDay(this.updatedShowData.paid_date):"",this.showOrderMessage=this.updatedShowData.message?this.splitStringByNewline(this.updatedShowData.message):[],this.showProductsArray=this.updatedShowData.products?Object.values(this.updatedShowData.products):[],this.inEditOrderMode=!1}},computed:{...I(B,["currentDate"])},mounted(){this.modal=new q(this.$refs.modal)}},Z={ref:"modal",class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},$={class:"modal-dialog modal-xl"},ee={class:"modal-content"},te={class:"modal-header"},se={class:"modal-title fs-5",id:"staticBackdropLabel"},oe={class:""},ae={key:1,disabled:"",type:"button",class:"btn"},de=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),le={key:0,class:"modal-body"},ne={class:"row mt-3"},re={key:0,class:"col-8"},ie=e("h6",null,[e("strong",null,"收件人名稱")],-1),ce=e("h6",null,[e("strong",null,"電子信箱")],-1),ue=e("h6",null,[e("strong",null,"行動電話號碼")],-1),he=e("h6",null,[e("strong",null,"收件地址")],-1),pe=e("h6",null,[e("strong",null,"訂單備註")],-1),me={key:0},_e={key:1},ge={key:1,class:"col-8"},be={class:"mb-3"},fe=e("label",{for:"user_name",class:"form-label"},[b("收件人名稱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),De={class:"mb-3"},we=e("label",{for:"user_email",class:"form-label"},[b("電子信箱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ye={class:"mb-3"},Oe=e("label",{for:"user_tel",class:"form-label"},[b("行動電話號碼 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ve={class:"mb-3"},Se=e("label",{for:"user_address",class:"form-label"},[b("收件地址 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Me={class:"mb-3"},ke=e("label",{for:"message",class:"form-label"},"訂單備註",-1),Ae={class:"col-4"},Te={key:0},xe={key:0,class:"text-main-spec fw-bold"},Ve={key:1,class:"text-deep-gray"},Ee={key:1},Pe={class:"form-check"},Ce={for:"is_paid",class:"form-check-label"},Be={key:0,class:"text-main-spec fw-bold"},Re={key:1,class:"text-deep-gray"},Ue={class:"table"},Le=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"類別"),e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"價格"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"},"總額"),e("th",{scope:"col"},"備註")])],-1),Ne=["src"],Ie={key:0},qe={key:1},Fe=["src"],je=e("td",null,"...",-1),Je=e("td",null,"...",-1),He=e("td",null,"...",-1),ze={colspan:"8"},Ge={class:"float-end"},Ke={key:0,class:"fs-3"},Qe={key:1,class:"fs-2"},We={class:"modal-footer"},Xe={key:1,type:"submit",class:"btn btn-solid-spec"};function Ye(l,o,u,v,t,n){const p=g("vee-field"),h=g("vee-error-message"),V=g("TwoTabs"),E=g("vee-form");return a(),d("div",Z,[e("div",$,[e("div",ee,[i(E,{onSubmit:n.putOrder},{default:T(({errors:f})=>[e("div",te,[e("h1",se,r(t.updatedShowData.num)+"｜訂單編號："+r(t.updatedShowData.id),1),e("div",oe,[t.inEditOrderMode?_("",!0):(a(),d("button",{key:0,type:"button",class:"btn",onClick:o[0]||(o[0]=(...s)=>n.editOrder&&n.editOrder(...s))}," 編輯訂單 ")),t.inEditOrderMode?(a(),d("button",ae,"編輯訂單中")):_("",!0),de])]),t.updatedShowData.user?(a(),d("div",le,[i(V,{tabs:t.tabs},{0:T(()=>[e("div",ne,[t.inEditOrderMode?(a(),d("div",ge,[e("div",be,[fe,i(p,{type:"text",name:"收件人",class:S(["form-control",{"is-invalid":f.收件人}]),rules:"required|max:15",id:"user_name",placeholder:"請輸入收件人名稱",modelValue:t.updatedShowData.user.name,"onUpdate:modelValue":o[1]||(o[1]=s=>t.updatedShowData.user.name=s)},null,8,["class","modelValue"]),i(h,{class:"invalid-feedback",name:"收件人"})]),e("div",De,[we,i(p,{type:"email",class:S(["form-control",{"is-invalid":f.電子信箱}]),id:"user_email",rules:"email|required",name:"電子信箱",placeholder:"請輸入電子信箱",modelValue:t.updatedShowData.user.email,"onUpdate:modelValue":o[2]||(o[2]=s=>t.updatedShowData.user.email=s)},null,8,["class","modelValue"]),i(h,{class:"invalid-feedback",name:"電子信箱"})]),e("div",ye,[Oe,i(p,{type:"tel",name:"行動電話",rules:n.isPhone,class:S(["form-control",{"is-invalid":f.行動電話}]),id:"user_tel",placeholder:"請輸入行動電話號碼",modelValue:t.updatedShowData.user.tel,"onUpdate:modelValue":o[3]||(o[3]=s=>t.updatedShowData.user.tel=s)},null,8,["rules","class","modelValue"]),i(h,{class:"invalid-feedback",name:"行動電話"})]),e("div",ve,[Se,i(p,{type:"text",name:"收件地址",class:S(["form-control",{"is-invalid":f.收件地址}]),rules:"required|max:100",id:"user_address",placeholder:"請輸入收件地址",modelValue:t.updatedShowData.user.address,"onUpdate:modelValue":o[4]||(o[4]=s=>t.updatedShowData.user.address=s)},null,8,["class","modelValue"]),i(h,{class:"invalid-feedback",name:"收件地址"})]),e("div",Me,[ke,i(p,{as:"textarea",name:"訂單備註",type:"text",class:S(["form-control",{"is-invalid":f.訂單備註}]),id:"message",placeholder:"請輸入訂單備註",rules:"max:800",modelValue:t.updatedShowData.message,"onUpdate:modelValue":o[5]||(o[5]=s=>t.updatedShowData.message=s)},null,8,["class","modelValue"]),i(h,{class:"invalid-feedback",name:"訂單備註"})])])):(a(),d("div",re,[e("div",null,[ie,e("p",null,r(t.updatedShowData.user.name),1)]),e("div",null,[ce,e("p",null,r(t.updatedShowData.user.email),1)]),e("div",null,[ue,e("p",null,r(t.updatedShowData.user.tel),1)]),e("div",null,[he,e("p",null,r(t.updatedShowData.user.address),1)]),e("div",null,[pe,this.updatedShowData.message?(a(),d("div",me,[(a(!0),d(k,null,x(t.showOrderMessage,(s,m)=>(a(),d("p",{key:m},r(s),1))),128))])):(a(),d("p",_e,"無訂單備註"))])])),e("div",Ae,[t.inEditOrderMode?(a(),d("ul",Ee,[e("li",null,[e("p",null,r(t.showCreateAt)+" 創立",1)]),e("li",null,[e("div",Pe,[F(e("input",{type:"checkbox",class:"form-check-input",id:"is_paid","onUpdate:modelValue":o[6]||(o[6]=s=>t.updatedShowData.is_paid=s)},null,512),[[j,t.updatedShowData.is_paid]]),e("label",Ce,[t.updatedShowData.is_paid?(a(),d("span",Be,r(t.showPaidDate)+" 已付款",1)):(a(),d("span",Re,"未付款"))])])])])):(a(),d("ul",Te,[e("li",null,[e("p",null,r(t.showCreateAt)+" 創立",1)]),e("li",null,[t.updatedShowData.is_paid?(a(),d("span",xe,r(t.showPaidDate)+" 已付款",1)):(a(),d("span",Ve,"未付款"))])]))])])]),1:T(()=>[e("table",Ue,[Le,e("tbody",null,[!t.inEditOrderMode&&t.updatedShowData.products?(a(!0),d(k,{key:0},x(t.showProductsArray,s=>{var m,D,w,y,O;return a(),d("tr",{key:s.id},[e("td",null,[e("img",{src:(m=s.product)==null?void 0:m.imageUrl,alt:"",width:"50"},null,8,Ne)]),e("td",null,r((D=s.product)==null?void 0:D.category),1),e("td",null,r((w=s.product)==null?void 0:w.title),1),e("td",null,[e("strong",null,r(s==null?void 0:s.qty),1)]),e("td",null,r((y=s.product)==null?void 0:y.price),1),e("td",null,r(s.total),1),e("td",null,[e("strong",null,r(s==null?void 0:s.final_total),1)]),e("td",null,[s.coupon?(a(),d("div",Ie,[e("p",null,[b(" 使用 "),e("strong",null,r((O=s.coupon)==null?void 0:O.title),1),b(" 優惠券 ")]),e("p",null,[b(" 折扣"),e("strong",null,"-"+r(s.total-s.final_total),1),b("元 ")])])):(a(),d("span",qe,"無"))])])}),128)):(a(!0),d(k,{key:1},x(t.showProductsArray,s=>{var m,D,w,y,O,c,A;return a(),d("tr",{key:s.id},[e("td",null,[e("img",{src:(m=s.product)==null?void 0:m.imageUrl,alt:"",width:"50"},null,8,Fe)]),e("td",null,r((D=s.product)==null?void 0:D.category),1),e("td",null,r((w=s.product)==null?void 0:w.title),1),e("td",null,[i(p,{name:((y=s.product)==null?void 0:y.title)+"產品數量",class:S(["form-control",{"is-invalid":f[((O=s.product)==null?void 0:O.title)+"產品數量"]}]),rules:"required|numeric|integer|min_value:1",type:"text",modelValue:s.qty,"onUpdate:modelValue":N=>s.qty=N,modelModifiers:{number:!0}},null,8,["name","class","modelValue","onUpdate:modelValue"]),i(h,{class:"invalid-feedback",name:((c=s.product)==null?void 0:c.title)+"產品數量"},null,8,["name"])]),e("td",null,r((A=s.product)==null?void 0:A.price),1),je,Je,He])}),128))]),e("tfoot",null,[e("tr",null,[e("td",ze,[e("p",Ge,[b(" 訂單總金額：NT$ "),t.inEditOrderMode?(a(),d("strong",Qe," ... ")):(a(),d("strong",Ke,r(t.updatedShowData.total),1))])])])])])]),_:2},1032,["tabs"])])):_("",!0),e("div",We,[t.inEditOrderMode?(a(),d("button",{key:0,type:"button",class:"btn btn-normal-dpgray",onClick:o[7]||(o[7]=(...s)=>n.cancelChangeOrder&&n.cancelChangeOrder(...s))}," 取消 ")):_("",!0),t.inEditOrderMode?(a(),d("button",Xe,"更新")):_("",!0),t.inEditOrderMode?_("",!0):(a(),d("button",{key:2,type:"button",class:"btn btn-solid-spec",onClick:o[8]||(o[8]=(...s)=>n.hideModal&&n.hideModal(...s))}," 關閉 "))])]),_:1},8,["onSubmit"])])])],512)}const Ze=U(Y,[["render",Ye]]);var $e={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:P,VITE_API_PATH:C}=$e,et={data(){return{isLoading:!1,adminOrdersData:[],serverMessage:{message:"",success:!0},showData:{}}},components:{PageBtn:J,OrderModal:Ze,DeleteModal:G,StatusMessage:K},computed:{},methods:{getOrderData(l){const o=this.adminOrdersData.orders.find(u=>u.id===l);this.showData=o,this.showData.title=`${this.showData.user.name}的訂單`},getAdminOrderModal(l){this.getOrderData(l),this.$refs.orderModal.openModal()},goToChangePage(l){this.getAdminOrders(l)},getAdminDelOrdersModal(){this.showData={title:"所有訂單"},this.$refs.deleteOrdersModal.openModal()},deleteAdminOrders(){const l=`${P}/v2/api/${C}/admin/orders/all`;this.$http.delete(l).then(o=>{this.getAdminOrders(),this.$refs.deleteOrdersModal.hideModal(),this.pushToast({title:o.data.message,style:"bg-deep-gray"})}).catch(o=>{this.handleServerResponse(!1,o.response.data.message)})},getAdminDelOrderModal(l){this.getOrderData(l),this.$refs.deleteOrderModal.openModal()},deleteAdminOrder(){const{id:l}=this.showData,o=`${P}/v2/api/${C}/admin/order/${l}`;this.$http.delete(o).then(u=>{this.getAdminOrders(),this.$refs.deleteOrderModal.hideModal(),this.pushToast({title:u.data.message,style:"bg-deep-gray"})}).catch(u=>{this.handleServerResponse(!1,u.response.data.message)})},getAdminOrders(l=1){const o=l.toString(),u=`${P}/v2/api/${C}/admin/orders`;this.$http.get(u,{params:{page:o}}).then(v=>{this.adminOrdersData=v.data,this.isLoading=!1}).catch(v=>{this.handleServerResponse(!1,v.response.data.message)})},handleServerResponse(l,o){this.serverMessage.success=l,this.serverMessage.message=o,this.$refs.resultModal.openModal()},...M(B,["dayToTimestamp10Code","timestamp10CodeToDay"]),...M(L,["pushToast"])},mounted(){this.isLoading=!0,this.getAdminOrders()}},tt={key:1,class:"container"},st={key:1,class:"row mt-4"},ot={class:"col d-flex justify-content-end"},at={key:2,class:"table mt-4"},dt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"創立日期"),e("th",{scope:"col"},"付款狀態"),e("th",{scope:"col"},"收件人名稱"),e("th",{scope:"col"},"電子信箱"),e("th",{scope:"col"},"行動電話號碼"),e("th",{scope:"col"},"收件地址"),e("th",{scope:"col"},"操作")])],-1),lt={scope:"row"},nt={key:0,class:"text-main-spec fw-bold"},rt={key:1,class:"text-deep-gray"},it={class:"d-flex justify-content-start align-items-center"},ct=["onClick"],ut=["onClick"],ht={key:3,class:"d-flex justify-content-center mt-4"},pt={"aria-label":"Page navigation example"},mt={class:"pagination",id:"pageid"};function _t(l,o,u,v,t,n){var m,D,w,y,O;const p=g("VueLoading"),h=g("StatusMessage"),V=g("PageBtn"),E=g("OrderModal"),f=g("DeleteModal"),s=g("ResultModal");return a(),d(k,null,[t.isLoading?(a(),R(p,{key:0,active:t.isLoading,"background-color":"#FBFAF4",color:"#52504B"},null,8,["active"])):(a(),d("div",tt,[((m=t.adminOrdersData.orders)==null?void 0:m.length)===0?(a(),R(h,{key:0,class:"mt-4"},{default:T(()=>[b(r("需等待訂單進入。"))]),_:1})):_("",!0),((D=t.adminOrdersData.orders)==null?void 0:D.length)*((w=t.adminOrdersData.pagination)==null?void 0:w.total_pages)>1?(a(),d("div",st,[e("div",ot,[e("button",{type:"button",class:"btn btn-solid-spec",onClick:o[0]||(o[0]=(...c)=>n.getAdminDelOrdersModal&&n.getAdminDelOrdersModal(...c))}," 刪除所有訂單 ")])])):_("",!0),((y=t.adminOrdersData.orders)==null?void 0:y.length)!==0?(a(),d("table",at,[dt,e("tbody",null,[(a(!0),d(k,null,x(t.adminOrdersData.orders,c=>(a(),d("tr",{key:c.id},[e("th",lt,r(c.num),1),e("td",null,r(l.timestamp10CodeToDay(c.create_at)),1),e("td",null,[c.is_paid?(a(),d("span",nt,"已付款")):(a(),d("span",rt,"未付款"))]),e("td",null,r(c.user.name),1),e("td",null,r(c.user.email),1),e("td",null,r(c.user.tel),1),e("td",null,r(c.user.address),1),e("td",null,[e("div",it,[e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:A=>n.getAdminDelOrderModal(c.id)}," 刪除 ",8,ct),e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:A=>n.getAdminOrderModal(c.id)}," 查看 ",8,ut)])])]))),128))])])):_("",!0),t.adminOrdersData&&t.adminOrdersData.pagination&&((O=t.adminOrdersData.orders)==null?void 0:O.length)!==0?(a(),d("div",ht,[e("nav",pt,[e("ul",mt,[i(V,{"prev-is-enabled":t.adminOrdersData.pagination.has_pre,"next-is-enabled":t.adminOrdersData.pagination.has_next,totalPage:t.adminOrdersData.pagination.total_pages,"current-page":t.adminOrdersData.pagination.current_page,onChangePrevPage:o[1]||(o[1]=c=>n.getAdminOrders(t.adminOrdersData.pagination.current_page-1)),onChangeNextPage:o[2]||(o[2]=c=>n.getAdminOrders(t.adminOrdersData.pagination.current_page+1)),onChangePage:n.goToChangePage},null,8,["prev-is-enabled","next-is-enabled","totalPage","current-page","onChangePage"])])])])):_("",!0)])),i(E,{ref:"orderModal","show-data":t.showData,onOrderUpdated:n.getAdminOrders},null,8,["show-data","onOrderUpdated"]),i(f,{ref:"deleteOrderModal","show-data":t.showData,onDeleteFunction:n.deleteAdminOrder},null,8,["show-data","onDeleteFunction"]),i(f,{ref:"deleteOrdersModal","show-data":t.showData,onDeleteFunction:n.deleteAdminOrders},null,8,["show-data","onDeleteFunction"]),i(s,{ref:"resultModal","server-message":t.serverMessage},null,8,["server-message"])],64)}const vt=U(et,[["render",_t]]);export{vt as default};
