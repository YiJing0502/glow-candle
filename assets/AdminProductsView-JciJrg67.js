import{M as E,a as k,_ as C,o as r,c as p,b as e,e as d,f as S,t as f,n as g,w as x,H as R,F as M,r as V,d as T,J as B,g as w,h as _,l as U,v as N,K as L}from"./index-b5Mq9qPg.js";import{t as I}from"./toastsStore-4YbyuFGs.js";import{D as O,S as j}from"./StatusMessage-Cqwc79SE.js";import{u as J}from"./uploadImagesStore-cSU-adnj.js";import{T as F}from"./TwoTabs-ftDsZ2o7.js";import{P as q}from"./PageBtn-bW9t-vCy.js";const H={data(){return{modal:"",updatedShowData:{},tabs:[{label:"產品內容"},{label:"產品圖片"}]}},props:["showData","inEditProductMode"],emits:["put-admin-product","post-admin-product"],components:{TwoTabs:F},mounted(){this.modal=new E(this.$refs.modal),this.updatedShowData=JSON.parse(JSON.stringify(this.showData))},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},methods:{resetAddForm(){this.$refs.form.resetForm()},openModal(){this.modal.show()},hideModal(){this.modal.hide()},putAdminProduct(){this.$emit("put-admin-product",this.updatedShowData)},postAdminProduct(){this.$emit("post-admin-product",this.updatedShowData)},deleteImage(a){let t=[...this.updatedShowData.imagesUrl];t=t.filter((n,h)=>h!==a),this.updatedShowData.imagesUrl=t},addImage(){this.updatedShowData.imagesUrl===void 0?this.updatedShowData.imagesUrl=[""]:this.updatedShowData.imagesUrl.push("")},async goToUploadImages(a){try{const t=await this.uploadImages(a);this.handleImagesResult(t);const n=a.target;n.value=null,this.handleServerResponse(!0,"圖片已成功上傳")}catch(t){this.handleServerResponse(!1,t.response.data.message)}},handleImagesResult(a){this.updatedShowData.imagesUrl=this.updatedShowData.imagesUrl||[],a.successfulUploads.length>0&&a.successfulUploads.map(t=>this.updatedShowData.imagesUrl.push(t.value.imageUrl)),a.failedUploads.length>0&&a.failedUploads.map(t=>this.handleServerResponse(!1,t.value.error))},handleServerResponse(a,t){const n=a?"bg-deep-gray":"bg-main-spec";this.pushToast({title:t,style:n})},...k(J,["uploadImages"]),...k(I,["pushToast"])}},K={class:"modal fade",ref:"modal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},z={class:"modal-dialog modal-xl"},G={class:"modal-content"},Q={class:"modal-header"},W={class:"modal-title fs-5",id:"staticBackdropLabel"},X=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},Z={class:"row mt-3"},$={class:"row"},ee={class:"col-10"},te={class:"mb-3"},se=e("label",{for:"title",class:"form-label"},[w("標題 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ae={class:"col-2 d-flex align-items-center"},oe={class:"form-check mt-3"},le={for:"is_enabled",class:"form-check-label"},de={key:0,class:"text-main-spec fw-bold"},ne={key:1,class:"text-deep-gray"},ie={class:"row"},re={class:"mb-3 col"},ce=e("label",{for:"category",class:"form-label"},[w("分類 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ue={class:"mb-3 col"},me=e("label",{for:"unit",class:"form-label"},[w("單位 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),pe={class:"row"},he={class:"mb-3 col"},ge=e("label",{for:"original_price",class:"form-label"},[w("原價 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),_e={class:"mb-3 col"},fe=e("label",{for:"price",class:"form-label"},[w("售價 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),be={class:"row"},ve={class:"mb-3 col"},we=e("label",{for:"cost_price",class:"form-label"},"成本價",-1),De={class:"mb-3 col"},ye=e("label",{for:"inventory",class:"form-label"},"庫存量",-1),Pe={class:"row"},Se={class:"col"},Me={class:"mb-3"},ke=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ve={class:"col"},Ae={class:"mb-3"},Ue=e("label",{for:"content",class:"form-label"},"說明內容",-1),Ce={class:"row row-cols-4 mt-3"},xe={class:"col mb-3"},Te={class:"mb-3"},Ie=e("label",{for:"imageUrl",class:"form-label"},"輸入主要圖片網址",-1),Ee=["src","alt"],Re={class:"mb-3"},Be={for:"imageUrl",class:"form-label"},Ne=["onClick"],Le=["src","alt"],Oe={class:"col mb-3"},je={class:"card"},Je={class:"card-body"},Fe=e("label",{for:"formFile",class:"form-label"},"上傳圖片檔案",-1),qe=e("ul",null,[e("li",null,"限jpg、jpeg、png類型的檔案"),e("li",null,"小於3MB")],-1),He=e("hr",null,null,-1),Ke={class:"modal-footer"},ze=e("button",{type:"button",class:"btn btn-normal-dpgray","data-bs-dismiss":"modal"}," 關閉 ",-1),Ge={type:"submit",class:"btn btn-solid-spec"};function Qe(a,t,n,h,s,l){const u=_("vee-field"),m=_("vee-error-message"),b=_("TwoTabs"),D=_("vee-form");return r(),p("div",K,[e("div",z,[e("div",G,[d(D,{ref:"form",onSubmit:t[12]||(t[12]=c=>n.inEditProductMode?l.putAdminProduct():l.postAdminProduct())},{default:S(({errors:c})=>[e("div",Q,[e("h1",W,f(n.inEditProductMode?"編輯產品":"新增產品"),1),X]),e("div",Y,[d(b,{tabs:s.tabs},{0:S(()=>[e("div",Z,[e("div",$,[e("div",ee,[e("div",te,[se,d(u,{type:"text",name:"標題",class:g([{"is-invalid":c.標題},"form-control"]),rules:"required|max:100",id:"title",placeholder:"請輸入標題",modelValue:s.updatedShowData.title,"onUpdate:modelValue":t[0]||(t[0]=i=>s.updatedShowData.title=i)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"標題"})])]),e("div",ae,[e("div",oe,[x(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[1]||(t[1]=i=>s.updatedShowData.is_enabled=i)},null,512),[[R,s.updatedShowData.is_enabled]]),e("label",le,[s.updatedShowData.is_enabled===1?(r(),p("span",de,"啟用")):(r(),p("span",ne,"未啟用"))])])])]),e("div",ie,[e("div",re,[ce,d(u,{type:"text",name:"分類",class:g(["form-control",{"is-invalid":c.分類}]),rules:"required|max:100",id:"category",placeholder:"請輸入分類",modelValue:s.updatedShowData.category,"onUpdate:modelValue":t[2]||(t[2]=i=>s.updatedShowData.category=i)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"分類"})]),e("div",ue,[me,d(u,{type:"text",name:"單位",class:g(["form-control",{"is-invalid":c.單位}]),rules:"required|max:100",id:"unit",placeholder:"請輸入單位",modelValue:s.updatedShowData.unit,"onUpdate:modelValue":t[3]||(t[3]=i=>s.updatedShowData.unit=i)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"單位"})])]),e("div",pe,[e("div",he,[ge,d(u,{type:"number",name:"原價",class:g(["form-control",{"is-invalid":c.原價}]),rules:"required|numeric|integer|min_value:1",id:"original_price",placeholder:"請輸入原價",modelValue:s.updatedShowData.origin_price,"onUpdate:modelValue":t[4]||(t[4]=i=>s.updatedShowData.origin_price=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"原價"})]),e("div",_e,[fe,d(u,{type:"number",name:"售價",class:g(["form-control",{"is-invalid":c.售價}]),rules:"required|numeric|integer|min_value:1",id:"price",placeholder:"請輸入售價",modelValue:s.updatedShowData.price,"onUpdate:modelValue":t[5]||(t[5]=i=>s.updatedShowData.price=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"售價"})])]),e("div",be,[e("div",ve,[we,d(u,{type:"number",name:"成本價",class:g(["form-control",{"is-invalid":c.成本價}]),rules:"numeric|integer|min_value:1",id:"cost_price",placeholder:"請輸入成本價",modelValue:s.updatedShowData.cost_price,"onUpdate:modelValue":t[6]||(t[6]=i=>s.updatedShowData.cost_price=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"成本價"})]),e("div",De,[ye,d(u,{type:"number",name:"庫存量",class:g(["form-control",{"is-invalid":c.庫存量}]),rules:"numeric|integer|min_value:1",id:"inventory",placeholder:"請輸入庫存量",modelValue:s.updatedShowData.inventory,"onUpdate:modelValue":t[7]||(t[7]=i=>s.updatedShowData.inventory=i),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"庫存量"})])]),e("div",Pe,[e("div",Se,[e("div",Me,[ke,d(u,{as:"textarea",name:"產品描述",class:g(["form-control",{"is-invalid":c.產品描述}]),rules:"max:800",id:"description",rows:"3",modelValue:s.updatedShowData.description,"onUpdate:modelValue":t[8]||(t[8]=i=>s.updatedShowData.description=i)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"產品描述"})])]),e("div",Ve,[e("div",Ae,[Ue,d(u,{as:"textarea",name:"說明內容",class:g(["form-control",{"is-invalid":c.說明內容}]),rules:"max:800",id:"content",rows:"3",modelValue:s.updatedShowData.content,"onUpdate:modelValue":t[9]||(t[9]=i=>s.updatedShowData.content=i)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"說明內容"})])])])])]),1:S(()=>[e("div",Ce,[e("div",xe,[e("div",Te,[Ie,d(u,{type:"text",name:"主要圖片網址",class:g(["form-control",{"is-invalid":c.主要圖片網址}]),rules:"url",placeholder:"請輸入主要圖片連結",modelValue:s.updatedShowData.imageUrl,"onUpdate:modelValue":t[10]||(t[10]=i=>s.updatedShowData.imageUrl=i)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"主要圖片網址"})]),e("img",{src:s.updatedShowData.imageUrl,alt:s.updatedShowData.title,class:"img-fluid"},null,8,Ee)]),(r(!0),p(M,null,V(s.updatedShowData.imagesUrl,(i,o)=>(r(),p("div",{class:"col mb-3",key:o},[e("div",Re,[e("label",Be,"輸入其他圖片網址"+f(o),1),e("button",{type:"button",class:"btn-close float-end","aria-label":"Close",onClick:v=>l.deleteImage(o)},null,8,Ne),d(u,{type:"text",name:"其他圖片連結"+o,class:g(["form-control",{"is-invalid":c["其他圖片連結"+o]}]),rules:"url",placeholder:"請輸入其他圖片連結",modelValue:s.updatedShowData.imagesUrl[o],"onUpdate:modelValue":v=>s.updatedShowData.imagesUrl[o]=v},null,8,["name","class","modelValue","onUpdate:modelValue"]),d(m,{class:"invalid-feedback",name:"其他圖片連結"+o},null,8,["name"])]),s.updatedShowData.imagesUrl[o]?(r(),p("img",{key:0,src:s.updatedShowData.imagesUrl[o],alt:s.updatedShowData.title+o,class:"img-fluid"},null,8,Le)):T("",!0)]))),128)),e("div",Oe,[e("div",je,[e("div",Je,[Fe,d(u,{class:g(["form-control",{"is-invalid":c.多圖片上傳}]),type:"file",name:"多圖片上傳",rules:"size:3072|ext:jpeg,jpg,png",onChange:l.goToUploadImages,ref:"uploadInput",accept:"image/jpeg, image/jpg, image/png",multiple:""},null,8,["class","onChange"]),d(m,{class:"invalid-feedback",name:"多圖片上傳"}),qe,He,e("button",{type:"button",class:"btn btn-solid-dpgray w-100",onClick:t[11]||(t[11]=B((...i)=>l.addImage&&l.addImage(...i),["prevent"]))}," 手動新增圖片 ")])])])])]),_:2},1032,["tabs"])]),e("div",Ke,[ze,e("button",Ge,f(n.inEditProductMode?"更新":"新增"),1)])]),_:1},512)])])],512)}const We=C(H,[["render",Qe]]);var Xe={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:y,VITE_API_PATH:P}=Xe,Ye={data(){return{getRemoteData:!1,productsData:[],paginationData:[],pageData:{},infoData:[],showData:{},inEditProductMode:!0,serverMessage:{message:"",success:!0},productsCategory:[],searchInputValue:""}},components:{DeleteModal:O,ProductModal:We,StatusMessage:j,PageBtn:q},methods:{getAdminProductModal(a){this.inEditProductMode=!0,this.showData=JSON.parse(JSON.stringify(this.productsData[a])),this.$refs.productModal.openModal()},getAdminAddProductModal(){this.inEditProductMode=!1,this.showData={},this.$refs.productModal.resetAddForm(),this.$refs.productModal.openModal()},getAdminDelProductModal(a){this.showData=JSON.parse(JSON.stringify(this.productsData[a])),this.$refs.deleteModal.openModal()},getAdminProductsAll(){const a=`${y}/v2/api/${P}/admin/products/all`;this.$http.get(a).then(t=>{t.data.success&&(this.getRemoteData=t.data.success,this.productsData=t.data.products,this.paginationData=t.data.products,this.pagination(1))}).catch(t=>{this.handleServerResponse(!1,t.response.data.message)})},postAdminProduct(a){const t=`${y}/v2/api/${P}/admin/product`,n={data:a};this.$http.post(t,n).then(h=>{this.getAdminProductsAll(),this.$refs.productModal.hideModal(),this.pushToast({title:h.data.message,style:"bg-deep-gray"})}).catch(h=>{this.handleServerResponse(!1,h.response.data.message)})},putAdminProduct(a){const{id:t}=a,n=`${y}/v2/api/${P}/admin/product/${t}`,h={data:a};this.$http.put(n,h).then(s=>{s.data.success&&(this.getAdminProductsAll(),this.$refs.productModal.hideModal(),this.pushToast({title:s.data.message,style:"bg-deep-gray"}))}).catch(s=>{this.handleServerResponse(!1,s.response.data.message)})},deleteAdminProduct(){const{id:a}=this.showData,t=`${y}/v2/api/${P}/admin/product/${a}`;this.$http.delete(t).then(n=>{n.data.success&&(this.$refs.deleteModal.hideModal(),this.getAdminProductsAll(),this.pushToast({title:n.data.message,style:"bg-deep-gray"}))}).catch(n=>{this.$refs.deleteModal.hideModal(),this.handleServerResponse(!1,n.response.data.message)})},pagination(a){const t=this.paginationData,n=Object.keys(t).length,h=10,s=Math.ceil(n/h);let l=a;l>s&&(l=s);const u=l*h-h+1,m=l*h,b=[];Object.keys(t).forEach((c,i)=>{const o=i+1;o>=u&&o<=m&&b.push(t[c])}),this.infoData=b;const D={totalPage:s,currentPage:l,hasPrevPage:l>1,hasNextPage:l<s};this.pageData=D},scrollToBottom(){const{scrollContainer:a}=this.$refs;a.scrollIntoView({behavior:"smooth",block:"end"})},getCategory(){const a=new Set;Object.keys(this.productsData).forEach(t=>{const{category:n}=this.productsData[t];a.add(n)}),this.productsCategory=Array.from(a)},filterCategory(a){this.paginationData=[],Object.keys(this.productsData).forEach(t=>{const n=this.productsData[t];n.category===a&&this.paginationData.push(n)}),this.pagination(1)},searchProduct(){const a=[],t=this.searchInputValue.toLowerCase();Object.keys(this.productsData).forEach(n=>{this.productsData[n].title.toLowerCase().match(t)&&a.push(this.productsData[n])}),a.length===0&&(this.serverMessage.message="很抱歉，沒有符合搜尋條件的產品",this.serverMessage.success=!1,this.$refs.resultModal.openModal()),this.paginationData=a,this.pagination(1)},handleServerResponse(a,t){this.serverMessage.success=a,this.serverMessage.message=t,this.$refs.resultModal.openModal()},...k(I,["pushToast"])},mounted(){this.getAdminProductsAll()}},Ze={key:1,class:"container"},$e={class:"row mt-4"},et={class:"col-8 d-flex"},tt={class:"btn-group me-3"},st={class:"dropdown-menu"},at=["onClick"],ot={class:"col-4 d-flex justify-content-end"},lt={key:1,class:"table mt-4 align-middle"},dt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),nt={scope:"row"},it=["src","alt"],rt={key:0,class:"text-main-spec fw-bold"},ct={key:1,class:"text-deep-gray"},ut={class:"d-flex justify-content-start align-items-center"},mt=["onClick"],pt=["onClick"],ht={class:"d-flex justify-content-center mt-4",ref:"scrollContainer"},gt={"aria-label":"Page navigation example"},_t={class:"pagination",id:"pageid"};function ft(a,t,n,h,s,l){const u=_("PageLoading"),m=_("status-message"),b=_("PageBtn"),D=_("ProductModal"),c=_("DeleteModal"),i=_("ResultModal");return r(),p(M,null,[s.getRemoteData?(r(),p("div",Ze,[e("div",$e,[e("div",et,[e("div",tt,[s.productsData?(r(),p("button",{key:0,class:"btn btn-normal-dpgray dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:t[0]||(t[0]=(...o)=>l.getCategory&&l.getCategory(...o))}," 篩選類別 ")):T("",!0),e("ul",st,[(r(!0),p(M,null,V(s.productsCategory,(o,v)=>(r(),p("li",{key:v},[e("button",{class:"dropdown-item",href:"#",onClick:A=>l.filterCategory(o)},f(o),9,at)]))),128))])]),x(e("input",{class:"form-control form-control-sm",id:"exampleDataList",placeholder:"輸入產品名稱搜尋","onUpdate:modelValue":t[1]||(t[1]=o=>s.searchInputValue=o),onKeyup:t[2]||(t[2]=L((...o)=>l.searchProduct&&l.searchProduct(...o),["enter"]))},null,544),[[N,s.searchInputValue,void 0,{trim:!0}]]),e("button",{class:"btn btn-normal-dpgray",onClick:t[3]||(t[3]=(...o)=>l.searchProduct&&l.searchProduct(...o))},"搜")]),e("div",ot,[e("button",{type:"button",onClick:t[4]||(t[4]=(...o)=>l.scrollToBottom&&l.scrollToBottom(...o)),class:"btn"},"前往底部"),e("button",{class:"btn btn-solid-spec",onClick:t[5]||(t[5]=(...o)=>l.getAdminAddProductModal&&l.getAdminAddProductModal(...o))},"建立新的產品")])]),s.productsData.length===0?(r(),U(m,{key:0},{default:S(()=>[w(f("請點擊「建立新的產品」新增資料"))]),_:1})):(r(),p("table",lt,[dt,e("tbody",null,[(r(!0),p(M,null,V(s.infoData,(o,v)=>(r(),p("tr",{key:v},[e("th",nt,[e("img",{src:o.imageUrl,alt:o.title,class:"img-fluid",width:"50"},null,8,it)]),e("td",null,f(o.category),1),e("td",null,f(o.title),1),e("td",null,f(o.origin_price),1),e("td",null,f(o.price),1),e("td",null,[o.is_enabled===1?(r(),p("span",rt,"啟用")):(r(),p("span",ct,"未啟用"))]),e("td",null,[e("div",ut,[e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:A=>l.getAdminDelProductModal(o.id)}," 刪除 ",8,mt),e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:A=>l.getAdminProductModal(o.id)}," 編輯 ",8,pt)])])]))),128))])])),e("div",ht,[e("nav",gt,[e("ul",_t,[d(b,{"prev-is-enabled":s.pageData.hasPrevPage,onChangePrevPage:t[6]||(t[6]=o=>l.pagination(s.pageData.currentPage-1)),totalPage:s.pageData.totalPage,"current-page":s.pageData.currentPage,onChangePage:l.pagination,"next-is-enabled":s.pageData.hasNextPage,onChangeNextPage:t[7]||(t[7]=o=>l.pagination(s.pageData.currentPage+1))},null,8,["prev-is-enabled","totalPage","current-page","onChangePage","next-is-enabled"])])])],512)])):(r(),U(u,{key:0})),d(D,{ref:"productModal","show-data":s.showData,"in-edit-product-mode":s.inEditProductMode,onPutAdminProduct:l.putAdminProduct,onPostAdminProduct:l.postAdminProduct},null,8,["show-data","in-edit-product-mode","onPutAdminProduct","onPostAdminProduct"]),d(c,{ref:"deleteModal","show-data":s.showData,onDeleteFunction:l.deleteAdminProduct},null,8,["show-data","onDeleteFunction"]),d(i,{ref:"resultModal","server-message":s.serverMessage},null,8,["server-message"])],64)}const St=C(Ye,[["render",ft]]);export{St as default};
