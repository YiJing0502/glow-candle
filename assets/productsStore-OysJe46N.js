import{K as f,L as l}from"./index-vqMCxPcU.js";var P={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:u,VITE_API_PATH:g}=P,w=f("productsStore",{state:()=>({productsData:[],showProductsData:[],isLoading:!1,productPagesData:{},productsCategory:[],productsPageStatus:"全部產品",uniqueSeriesArray:[],uniqueTonesArray:[],uniqueCapacitiesArray:[],candlesData:[],calmSeriesProducts:["-NoLTSCPuUQGarWezIAl","-NoLWB8MDGIYr9flJ0Pb","-NoLWTOY-q1QXZOnQmEN","-NoLWnut3G93WzfuedRW"],bestsellers:["-NoLXYH97x33NA7DUGnQ","-NoLY64ZdZ5tKG0MYgXk","-NoL_80KGaePj1gdr6Gp","-NoLRz5ol1emgz6xq7j0"],calmSeriesBundle:{},bestsellersData:[],calmSeriesData:[],recommendationsData:[]}),getters:{},actions:{getProductsAll(t=!1,s=1){this.isLoading=!0;const e=`${u}/v2/api/${g}/products/all`;return new Promise((o,i)=>{l.get(e).then(a=>{t?(this.productsData=a.data.products,this.getCandlesData(),this.getCandleFilterArray(),this.getCategory(),Promise.all(this.calmSeriesProducts.map(r=>this.getParticularProduct(r))).then(r=>{this.calmSeriesData=r}),Promise.all(this.bestsellers.map(r=>this.getParticularProduct(r))).then(r=>{this.bestsellersData=r})):(this.productsPageStatus="全部產品",this.showProductsData=a.data.products,this.pagination(s)),o(a),this.isLoading=!1}).catch(a=>{i(a)})})},getProducts(t,s=1){this.isLoading=!0;const e=`${u}/v2/api/${g}/products`;return new Promise((o,i)=>{l.get(e,{params:{category:t,page:s}}).then(a=>{this.productPagesData=a.data,this.productsPageStatus=t,this.isLoading=!1,o(a)}).catch(a=>{i(a)})})},pagination(t){const s=this.showProductsData,e=Object.keys(s).length,o=10,i=Math.ceil(e/o);let a=t;a>i&&(a=i);const r=a*o-o+1,c=a*o,d=[];Object.keys(s).forEach((p,m)=>{const h=m+1;h>=r&&h<=c&&d.push(s[p])});const n={total_pages:i,current_page:a,has_pre:a>1,has_next:a<i};this.productPagesData={products:d,pagination:n}},getCategory(){const t=new Set;Object.keys(this.productsData).forEach(s=>{const{category:e}=this.productsData[s];t.add(e)}),this.productsCategory=Array.from(t)},sortPrice(t){let s;t.key&&t.content?s=this.showProductsData:t.category==="全部產品"?s=this.productsData:s=this.productsData.filter(e=>e.category===t.category),t.price==="asc"?s.sort((e,o)=>e.price-o.price):t.price==="desc"&&s.sort((e,o)=>o.price-e.price),this.showProductsData=s,this.pagination(t.page)},getCandlesData(){this.candlesData=this.productsData.filter(t=>t.category==="香氛蠟燭")},getCandleFilterArray(){const t=this.candlesData,s=new Set,e=new Set,o=new Set;t.forEach(i=>{const a=i.title.split("｜");a[2]!==void 0&&a[1]!==void 0&&a[3]!==void 0&&(s.add(a[2]),e.add(a[1]),o.add(a[3]))}),this.uniqueSeriesArray=Array.from(s),this.uniqueTonesArray=Array.from(e),this.uniqueCapacitiesArray=Array.from(o).sort((i,a)=>parseInt(i.replace(/[^0-9]/g,""),10)-parseInt(a.replace(/[^0-9]/g,""),10))},filterCandles(t,s,e=1){this.showProductsData=[],this.productsPageStatus="香氛蠟燭",this.candlesData.forEach(i=>{i.title.split("｜")[t]===s&&this.showProductsData.push(i)}),this.pagination(e)},initializePage(t){t.category==="全部產品"?this.getProductsAll(!1,t.page):t.key&&t.content?this.filterCandles(t.key,t.content,t.page):this.productsCategory.findIndex(e=>e===t.category)!==-1&&this.getProducts(t.category,t.page)},getParticularProduct(t){return new Promise((s,e)=>{const o=()=>{const a=this.productsData.find(r=>r.id===t);a===void 0?e(a):s(a)},i=()=>{this.isLoading?setTimeout(i,100):o()};i()})},async recommendations(t){this.recommendationsData=[];const s={error:null};try{const e=await this.getParticularProduct(t),{title:o}=e,i=o.split("｜")[2],{category:a}=e,r=this.productsData.filter(c=>c.category===a);if(a==="香氛蠟燭"){const d=r.filter(n=>n.title.split("｜")[2]===i).filter(n=>n.id!==t);d.length<4&&this.getParticularProduct("-NoLX8ZL10JiBTlwGN6T").then(n=>{d.push(n),this.recommendationsData=d}),d.length===4&&(this.recommendationsData=d)}if(a==="送禮搭配")for(;this.recommendationsData.length<4;){const c=this.getRandomProduct(r);this.recommendationsData.findIndex(n=>n.id===c.id)===-1&&c.id!==t&&this.recommendationsData.push(c)}if(a==="蠟燭配件")for(;this.recommendationsData.length<4;){let c=this.getRandomProduct(r);this.recommendationsData.length>=r.length-1&&(c=this.getRandomProduct(this.candlesData)),this.recommendationsData.findIndex(n=>n.id===c.id)===-1&&c.id!==t&&this.recommendationsData.push(c)}}catch(e){e===void 0&&(s.error={message:"找不到對應的資料",success:!1})}return s},getRandomProduct(t){const s=Math.floor(Math.random()*t.length);return t[s]},searchProduct(t){const s=[],e=t.toLowerCase();Object.keys(this.productsData).forEach(o=>{this.productsData[o].title.toLowerCase().match(e)&&s.push(this.productsData[o])}),this.showProductsData=s}}});export{w as p};
