import{m as w,M as T,_ as A,o as n,c,b as e,t as p,l as r,v as m,p as V,a as f,g as v,w as N,F as C,j as R,d as g,r as h,e as O}from"./index-FQB6OFt_.js";import{t as y}from"./timeStore-Xf2pNphl.js";import{a as D}from"./adminStore-DN_Qu87h.js";import{S as B,D as P}from"./StatusMessage-NrD26kvZ.js";const U={data(){return{modal:"",updatedShowData:{}}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},putAdminCoupon(){this.$emit("put-admin-coupon",this.updatedShowData)},postAdminCoupon(){this.$emit("post-admin-coupon",this.updatedShowData)}},computed:{...w(y,["currentDate"])},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},props:["inEditCouponMode","showData"],emits:["put-admin-coupon","post-admin-coupon"],mounted(){this.modal=new T(this.$refs.modal),this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},J={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true","data-bs-backdrop":"static","data-bs-keyboard":"false"},L={class:"modal-dialog modal-xl"},F={class:"modal-content"},I={class:"modal-header"},j={class:"modal-title fs-5",id:"exampleModalLabel"},H=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},q={class:"row"},G={class:"col-10"},K={class:"mb-3"},Q=e("label",{for:"coupon_title",class:"form-label"},"標題",-1),W={class:"col-2 d-flex align-items-center"},X={class:"form-check mt-3"},Y={for:"is_enabled",class:"form-check-label"},Z={key:0,class:"text-main-spec fw-bold"},ee={key:1,class:"text-deep-gray"},se={class:"row"},oe={class:"col mb-3"},te=e("label",{for:"coupon_due_date",class:"form-label"},"到期日",-1),ae=["min"],de={class:"col mb-3"},ne=e("label",{for:"coupon_percent",class:"form-label"},"折扣",-1),le={class:"col mb-3"},ie=e("label",{for:"coupon_code",class:"form-label"},"折扣代碼",-1),ce={class:"modal-footer"},ue=e("button",{type:"button",class:"btn btn-normal-dpgray","data-bs-dismiss":"modal"},"關閉",-1);function pe(t,s,a,l,o,i){return n(),c("div",J,[e("div",L,[e("div",F,[e("div",I,[e("h1",j,p(a.inEditCouponMode?"編輯優惠券":"新增優惠券"),1),H]),e("div",z,[e("div",q,[e("div",G,[e("div",K,[Q,r(e("input",{type:"text",class:"form-control",id:"coupon_title",placeholder:"請輸入標題","onUpdate:modelValue":s[0]||(s[0]=d=>o.updatedShowData.title=d)},null,512),[[m,o.updatedShowData.title]])])]),e("div",W,[e("div",X,[r(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":s[1]||(s[1]=d=>o.updatedShowData.is_enabled=d)},null,512),[[V,o.updatedShowData.is_enabled]]),e("label",Y,[o.updatedShowData.is_enabled===1?(n(),c("span",Z,"啟用")):(n(),c("span",ee,"未啟用"))])])])]),e("div",se,[e("div",oe,[te,r(e("input",{type:"date",class:"form-control",id:"coupon_due_date",placeholder:"請輸入到期日","onUpdate:modelValue":s[2]||(s[2]=d=>o.updatedShowData.due_date=d),min:t.currentDate},null,8,ae),[[m,o.updatedShowData.due_date]])]),e("div",de,[ne,r(e("input",{type:"number",class:"form-control",id:"coupon_percent",placeholder:"請輸入折扣","onUpdate:modelValue":s[3]||(s[3]=d=>o.updatedShowData.percent=d)},null,512),[[m,o.updatedShowData.percent]])]),e("div",le,[ie,r(e("input",{type:"text",class:"form-control",id:"coupon_code",placeholder:"請輸入折扣代碼","onUpdate:modelValue":s[4]||(s[4]=d=>o.updatedShowData.code=d)},null,512),[[m,o.updatedShowData.code]])])])]),e("div",ce,[ue,e("button",{type:"button",class:"btn btn-solid-spec",onClick:s[5]||(s[5]=d=>a.inEditCouponMode?i.putAdminCoupon():i.postAdminCoupon())},p(a.inEditCouponMode?"更新":"新增"),1)])])])],512)}const re=A(U,[["render",pe]]);var he={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:_,VITE_API_PATH:M}=he,me={data(){return{getRemoteData:!1,couponsData:[],showData:{},inEditCouponMode:!0,serverMessage:{message:"",success:!0}}},components:{StatusMessage:B,DeleteModal:P,CouponModal:re},methods:{getAdminAddCouponModal(){this.inEditCouponMode=!1,this.showData={},this.$refs.couponModal.openModal()},getAdminCouponModal(t){this.inEditCouponMode=!0,this.showData=JSON.parse(JSON.stringify(this.couponsData[t])),this.showData.due_date=this.timestamp10CodeToDay(this.showData.due_date),this.$refs.couponModal.openModal()},getAdminDeleCouponModal(t){this.showData=JSON.parse(JSON.stringify(this.couponsData[t])),this.$refs.deleteModal.openModal()},getAdminCoupons(){const t=`${_}/v2/api/${M}/admin/coupons`;this.$http.get(t).then(s=>{this.getRemoteData=s.data.success,this.couponsData=s.data.coupons}).catch(s=>{this.serverMessage.message=s.response.data.message,this.serverMessage.success=s.response.data.success,this.$refs.resultModal.openModal()})},postAdminCoupon(t){const s=`${_}/v2/api/${M}/admin/coupon`,a={data:t};a.data.due_date=this.dayToTimestamp10Code(t.due_date),this.$http.post(s,a).then(l=>{this.getAdminCoupons(),this.serverMessage.message=l.data.message,this.serverMessage.success=l.data.success,this.$refs.couponModal.hideModal(),this.$refs.resultModal.openModal()}).catch(l=>{this.serverMessage.message=l.response.data.message,this.serverMessage.success=l.response.data.success,this.$refs.resultModal.openModal()})},putAdminCoupon(t){const{id:s}=t,a=`${_}/v2/api/${M}/admin/coupon/${s}`,l={data:t};l.data.due_date=this.dayToTimestamp10Code(t.due_date),this.$http.put(a,l).then(o=>{this.getAdminCoupons(),this.serverMessage.message=o.data.message,this.serverMessage.success=o.data.success,this.$refs.couponModal.hideModal(),this.$refs.resultModal.openModal()}).catch(o=>{this.serverMessage.message=o.response.data.message,this.serverMessage.success=o.response.data.success,this.$refs.resultModal.openModal()})},deleteAdminCoupon(){const{id:t}=this.showData,s=`${_}/v2/api/${M}/admin/coupon/${t}`;this.$http.delete(s).then(a=>{this.getAdminCoupons(),this.serverMessage.message=a.data.message,this.serverMessage.success=a.data.success,this.$refs.deleteModal.hideModal(),this.$refs.resultModal.openModal()}).catch(a=>{this.serverMessage.message=a.response.data.message,this.serverMessage.success=a.response.data.success,this.$refs.resultModal.openModal()})},...f(D,["initializeAdmin","postApiUserCheck"]),...f(y,["dayToTimestamp10Code","timestamp10CodeToDay"])},computed:{...w(D,["loginSuccess"])},mounted(){this.loginSuccess&&this.getAdminCoupons()}},_e={key:1,class:"container"},Me={class:"row mt-4"},ge={class:"col d-flex justify-content-end"},be={key:1,class:"table mt-4 align-middle"},fe=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"代碼"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),ve={key:0,class:"text-main-spec fw-bold"},Ce={key:1,class:"text-deep-gray"},De=["onClick"],we=["onClick"];function Ae(t,s,a,l,o,i){const d=h("VueLoading"),S=h("status-message"),k=h("CouponModal"),$=h("DeleteModal"),x=h("ResultModal");return n(),c(C,null,[o.getRemoteData?(n(),c("div",_e,[e("div",Me,[e("div",ge,[e("button",{type:"button",class:"btn btn-solid-spec",onClick:s[0]||(s[0]=(...u)=>i.getAdminAddCouponModal&&i.getAdminAddCouponModal(...u))}," 建立新的優惠券 ")])]),o.couponsData.length===0?(n(),v(S,{key:0},{default:N(()=>[O(p("建立新的優惠券"))]),_:1})):(n(),c("table",be,[fe,e("tbody",null,[(n(!0),c(C,null,R(o.couponsData,(u,b)=>(n(),c("tr",{key:u.id},[e("th",null,p(u.title),1),e("td",null,p(u.percent),1),e("td",null,p(t.timestamp10CodeToDay(u.due_date)),1),e("td",null,p(u.code),1),e("td",null,[u.is_enabled===1?(n(),c("span",ve,"啟用")):(n(),c("span",Ce,"未啟用"))]),e("td",null,[e("button",{type:"button",class:"btn btn-sm btn-normal-medium block w-50",onClick:E=>i.getAdminDeleCouponModal(b)}," 刪除 ",8,De),e("button",{type:"button",class:"btn btn-sm btn-normal-medium block w-50",onClick:E=>i.getAdminCouponModal(b)}," 編輯 ",8,we)])]))),128))])]))])):(n(),v(d,{key:0,active:!o.getRemoteData,"background-color":"#FBFAF4",color:"#52504B"},null,8,["active"])),g(k,{ref:"couponModal","in-edit-coupon-mode":o.inEditCouponMode,"show-data":o.showData,onPostAdminCoupon:i.postAdminCoupon,onPutAdminCoupon:i.putAdminCoupon},null,8,["in-edit-coupon-mode","show-data","onPostAdminCoupon","onPutAdminCoupon"]),g($,{ref:"deleteModal","show-data":o.showData,onDeleteFunction:i.deleteAdminCoupon},null,8,["show-data","onDeleteFunction"]),g(x,{ref:"resultModal","server-message":o.serverMessage},null,8,["server-message"])],64)}const xe=A(me,[["render",Ae]]);export{xe as default};
