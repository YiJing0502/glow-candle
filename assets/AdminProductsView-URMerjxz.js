import{M as I,a as k,_ as U,I as C,o as c,c as p,b as e,f as d,g as S,t as _,n as g,w as x,L as E,F as M,r as A,d as T,P as B,e as v,h as f,q as V,v as N,Q as L,i as O}from"./index-vSMGsHVG.js";import{D as R,S as j}from"./StatusMessage-ZOVcQamq.js";import{u as F}from"./uploadImagesStore-sBbt-0v1.js";import{T as J}from"./TwoTabs-7hn7SeKH.js";import{P as q}from"./PageBtn-tCV6EUDj.js";const z={data(){return{modal:"",updatedShowData:{},tabs:[{label:"產品內容"},{label:"產品圖片"}]}},props:["showData","inEditProductMode"],emits:["put-admin-product","post-admin-product"],components:{TwoTabs:J},mounted(){this.modal=new I(this.$refs.modal),this.updatedShowData=JSON.parse(JSON.stringify(this.showData))},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},methods:{resetAddForm(){this.$refs.form.resetForm()},openModal(){this.modal.show()},hideModal(){this.modal.hide()},putAdminProduct(){this.$emit("put-admin-product",this.updatedShowData)},postAdminProduct(){this.$emit("post-admin-product",this.updatedShowData)},deleteImage(o){let t=[...this.updatedShowData.imagesUrl];t=t.filter((n,h)=>h!==o),this.updatedShowData.imagesUrl=t},addImage(){this.updatedShowData.imagesUrl===void 0?this.updatedShowData.imagesUrl=[""]:this.updatedShowData.imagesUrl.push("")},async goToUploadImages(o){try{const t=await this.uploadImages(o);this.handleImagesResult(t);const n=o.target;n.value=null,this.handleServerResponse(!0,"圖片已成功上傳")}catch(t){this.handleServerResponse(!1,t.response.data.message)}},handleImagesResult(o){this.updatedShowData.imagesUrl=this.updatedShowData.imagesUrl||[],o.successfulUploads.length>0&&o.successfulUploads.map(t=>this.updatedShowData.imagesUrl.push(t.value.imageUrl)),o.failedUploads.length>0&&o.failedUploads.map(t=>this.handleServerResponse(!1,t.value.error))},handleServerResponse(o,t){const n=o?"bg-deep-gray":"bg-main-spec";this.pushToast({title:t,style:n})},...k(F,["uploadImages"]),...k(C,["pushToast"])}},H={class:"modal fade",ref:"modal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},K={class:"modal-dialog modal-xl"},Q={class:"modal-content"},G={class:"modal-header"},W={class:"modal-title fs-5",id:"staticBackdropLabel"},X=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Y={class:"modal-body"},Z={class:"row mt-3"},$={class:"row"},ee={class:"col-10"},te={class:"mb-3"},ae=e("label",{for:"title",class:"form-label"},[v("標題 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),se={class:"col-2 d-flex align-items-center"},oe={class:"form-check mt-3"},le={for:"is_enabled",class:"form-check-label"},de={key:0,class:"text-main-spec fw-bold"},ne={key:1,class:"text-deep-gray"},ie={class:"row"},ce={class:"mb-3 col"},re=e("label",{for:"category",class:"form-label"},[v("分類 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ue={class:"mb-3 col"},me=e("label",{for:"unit",class:"form-label"},[v("單位 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),pe={class:"row"},he={class:"mb-3 col"},ge=e("label",{for:"original_price",class:"form-label"},[v("原價 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),_e={class:"mb-3 col"},fe=e("label",{for:"price",class:"form-label"},[v("售價 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),be={class:"row"},ve={class:"mb-3 col"},we=e("label",{for:"cost_price",class:"form-label"},"成本價",-1),De={class:"mb-3 col"},ye=e("label",{for:"inventory",class:"form-label"},"庫存量",-1),Pe={class:"row"},Se={class:"col"},Me={class:"mb-3"},ke=e("label",{for:"description",class:"form-label"},"產品描述",-1),Ae={class:"col"},Ve={class:"mb-3"},Ue=e("label",{for:"content",class:"form-label"},"說明內容",-1),Ce={class:"row row-cols-4 mt-3"},xe={class:"col mb-3"},Te={class:"mb-3"},Ie=e("label",{for:"imageUrl",class:"form-label"},"輸入主要圖片網址",-1),Ee=["src","alt"],Be={class:"mb-3"},Ne={for:"imageUrl",class:"form-label"},Le=["onClick"],Oe=["src","alt"],Re={class:"col mb-3"},je={class:"card"},Fe={class:"card-body"},Je=e("label",{for:"formFile",class:"form-label"},"上傳圖片檔案",-1),qe=e("ul",null,[e("li",null,"限jpg、jpeg、png類型的檔案"),e("li",null,"小於3MB")],-1),ze=e("hr",null,null,-1),He={class:"modal-footer"},Ke=e("button",{type:"button",class:"btn btn-normal-dpgray","data-bs-dismiss":"modal"}," 關閉 ",-1),Qe={type:"submit",class:"btn btn-solid-spec"};function Ge(o,t,n,h,a,l){const u=f("vee-field"),m=f("vee-error-message"),b=f("TwoTabs"),w=f("vee-form");return c(),p("div",H,[e("div",K,[e("div",Q,[d(w,{ref:"form",onSubmit:t[12]||(t[12]=r=>n.inEditProductMode?l.putAdminProduct():l.postAdminProduct())},{default:S(({errors:r})=>[e("div",G,[e("h1",W,_(n.inEditProductMode?"編輯產品":"新增產品"),1),X]),e("div",Y,[d(b,{tabs:a.tabs},{0:S(()=>[e("div",Z,[e("div",$,[e("div",ee,[e("div",te,[ae,d(u,{type:"text",name:"標題",class:g([{"is-invalid":r.標題},"form-control"]),rules:"required|max:100",id:"title",placeholder:"請輸入標題",modelValue:a.updatedShowData.title,"onUpdate:modelValue":t[0]||(t[0]=s=>a.updatedShowData.title=s)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"標題"})])]),e("div",se,[e("div",oe,[x(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[1]||(t[1]=s=>a.updatedShowData.is_enabled=s)},null,512),[[E,a.updatedShowData.is_enabled]]),e("label",le,[a.updatedShowData.is_enabled===1?(c(),p("span",de,"啟用")):(c(),p("span",ne,"未啟用"))])])])]),e("div",ie,[e("div",ce,[re,d(u,{type:"text",name:"分類",class:g(["form-control",{"is-invalid":r.分類}]),rules:"required|max:100",id:"category",placeholder:"請輸入分類",modelValue:a.updatedShowData.category,"onUpdate:modelValue":t[2]||(t[2]=s=>a.updatedShowData.category=s)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"分類"})]),e("div",ue,[me,d(u,{type:"text",name:"單位",class:g(["form-control",{"is-invalid":r.單位}]),rules:"required|max:100",id:"unit",placeholder:"請輸入單位",modelValue:a.updatedShowData.unit,"onUpdate:modelValue":t[3]||(t[3]=s=>a.updatedShowData.unit=s)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"單位"})])]),e("div",pe,[e("div",he,[ge,d(u,{type:"number",name:"原價",class:g(["form-control",{"is-invalid":r.原價}]),rules:"required|numeric|integer|min_value:1",id:"original_price",placeholder:"請輸入原價",modelValue:a.updatedShowData.origin_price,"onUpdate:modelValue":t[4]||(t[4]=s=>a.updatedShowData.origin_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"原價"})]),e("div",_e,[fe,d(u,{type:"number",name:"售價",class:g(["form-control",{"is-invalid":r.售價}]),rules:"required|numeric|integer|min_value:1",id:"price",placeholder:"請輸入售價",modelValue:a.updatedShowData.price,"onUpdate:modelValue":t[5]||(t[5]=s=>a.updatedShowData.price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"售價"})])]),e("div",be,[e("div",ve,[we,d(u,{type:"number",name:"成本價",class:g(["form-control",{"is-invalid":r.成本價}]),rules:"numeric|integer|min_value:1",id:"cost_price",placeholder:"請輸入成本價",modelValue:a.updatedShowData.cost_price,"onUpdate:modelValue":t[6]||(t[6]=s=>a.updatedShowData.cost_price=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"成本價"})]),e("div",De,[ye,d(u,{type:"number",name:"庫存量",class:g(["form-control",{"is-invalid":r.庫存量}]),rules:"numeric|integer|min_value:1",id:"inventory",placeholder:"請輸入庫存量",modelValue:a.updatedShowData.inventory,"onUpdate:modelValue":t[7]||(t[7]=s=>a.updatedShowData.inventory=s),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"庫存量"})])]),e("div",Pe,[e("div",Se,[e("div",Me,[ke,d(u,{as:"textarea",name:"產品描述",class:g(["form-control",{"is-invalid":r.產品描述}]),rules:"max:800",id:"description",rows:"3",modelValue:a.updatedShowData.description,"onUpdate:modelValue":t[8]||(t[8]=s=>a.updatedShowData.description=s)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"產品描述"})])]),e("div",Ae,[e("div",Ve,[Ue,d(u,{as:"textarea",name:"說明內容",class:g(["form-control",{"is-invalid":r.說明內容}]),rules:"max:800",id:"content",rows:"3",modelValue:a.updatedShowData.content,"onUpdate:modelValue":t[9]||(t[9]=s=>a.updatedShowData.content=s)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"說明內容"})])])])])]),1:S(()=>[e("div",Ce,[e("div",xe,[e("div",Te,[Ie,d(u,{type:"text",name:"主要圖片網址",class:g(["form-control",{"is-invalid":r.主要圖片網址}]),rules:"url",placeholder:"請輸入主要圖片連結",modelValue:a.updatedShowData.imageUrl,"onUpdate:modelValue":t[10]||(t[10]=s=>a.updatedShowData.imageUrl=s)},null,8,["class","modelValue"]),d(m,{class:"invalid-feedback",name:"主要圖片網址"})]),e("img",{src:a.updatedShowData.imageUrl,alt:a.updatedShowData.title,class:"img-fluid"},null,8,Ee)]),(c(!0),p(M,null,A(a.updatedShowData.imagesUrl,(s,i)=>(c(),p("div",{class:"col mb-3",key:i},[e("div",Be,[e("label",Ne,"輸入其他圖片網址"+_(i),1),e("button",{type:"button",class:"btn-close float-end","aria-label":"Close",onClick:D=>l.deleteImage(i)},null,8,Le),d(u,{type:"text",name:"其他圖片連結"+i,class:g(["form-control",{"is-invalid":r["其他圖片連結"+i]}]),rules:"url",placeholder:"請輸入其他圖片連結",modelValue:a.updatedShowData.imagesUrl[i],"onUpdate:modelValue":D=>a.updatedShowData.imagesUrl[i]=D},null,8,["name","class","modelValue","onUpdate:modelValue"]),d(m,{class:"invalid-feedback",name:"其他圖片連結"+i},null,8,["name"])]),a.updatedShowData.imagesUrl[i]?(c(),p("img",{key:0,src:a.updatedShowData.imagesUrl[i],alt:a.updatedShowData.title+i,class:"img-fluid"},null,8,Oe)):T("",!0)]))),128)),e("div",Re,[e("div",je,[e("div",Fe,[Je,d(u,{class:g(["form-control",{"is-invalid":r.多圖片上傳}]),type:"file",name:"多圖片上傳",rules:"size:3072|ext:jpeg,jpg,png",onChange:l.goToUploadImages,ref:"uploadInput",accept:"image/jpeg, image/jpg, image/png",multiple:""},null,8,["class","onChange"]),d(m,{class:"invalid-feedback",name:"多圖片上傳"}),qe,ze,e("button",{type:"button",class:"btn btn-solid-dpgray w-100",onClick:t[11]||(t[11]=B((...s)=>l.addImage&&l.addImage(...s),["prevent"]))}," 手動新增圖片 ")])])])])]),_:2},1032,["tabs"])]),e("div",He,[Ke,e("button",Qe,_(n.inEditProductMode?"更新":"新增"),1)])]),_:1},512)])])],512)}const We=U(z,[["render",Ge]]);var Xe={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:y,VITE_API_PATH:P}=Xe,Ye={data(){return{getRemoteData:!1,productsData:[],paginationData:[],pageData:{},infoData:[],showData:{},inEditProductMode:!0,productsCategory:[],searchInputValue:""}},components:{DeleteModal:R,ProductModal:We,StatusMessage:j,PageBtn:q},methods:{getAdminProductModal(o){this.inEditProductMode=!0,this.showData=JSON.parse(JSON.stringify(this.productsData[o])),this.$refs.productModal.openModal()},getAdminAddProductModal(){this.inEditProductMode=!1,this.showData={},this.$refs.productModal.resetAddForm(),this.$refs.productModal.openModal()},getAdminDelProductModal(o){this.showData=JSON.parse(JSON.stringify(this.productsData[o])),this.$refs.deleteModal.openModal()},getAdminProductsAll(){const o=`${y}/v2/api/${P}/admin/products/all`;this.$http.get(o).then(t=>{t.data.success&&(this.getRemoteData=t.data.success,this.productsData=t.data.products,this.paginationData=t.data.products,this.pagination(1))}).catch(t=>{this.getRemoteData=!0,this.showAlertMessage(!1,t.response.data.message)})},postAdminProduct(o){const t=`${y}/v2/api/${P}/admin/product`,n={data:o};this.$http.post(t,n).then(h=>{this.getAdminProductsAll(),this.$refs.productModal.hideModal(),this.pushToast({title:h.data.message,style:"bg-deep-gray"})}).catch(h=>{this.showAlertMessage(!1,h.response.data.message)})},putAdminProduct(o){const{id:t}=o,n=`${y}/v2/api/${P}/admin/product/${t}`,h={data:o};this.$http.put(n,h).then(a=>{a.data.success&&(this.getAdminProductsAll(),this.$refs.productModal.hideModal(),this.pushToast({title:a.data.message,style:"bg-deep-gray"}))}).catch(a=>{this.showAlertMessage(!1,a.response.data.message)})},deleteAdminProduct(){const{id:o}=this.showData,t=`${y}/v2/api/${P}/admin/product/${o}`;this.$http.delete(t).then(n=>{n.data.success&&(this.$refs.deleteModal.hideModal(),this.getAdminProductsAll(),this.pushToast({title:n.data.message,style:"bg-deep-gray"}))}).catch(n=>{this.$refs.deleteModal.hideModal(),this.showAlertMessage(!1,n.response.data.message)})},pagination(o){const t=this.paginationData,n=Object.keys(t).length,h=10,a=Math.ceil(n/h);let l=o;l>a&&(l=a);const u=l*h-h+1,m=l*h,b=[];Object.keys(t).forEach((r,s)=>{const i=s+1;i>=u&&i<=m&&b.push(t[r])}),this.infoData=b;const w={totalPage:a,currentPage:l,hasPrevPage:l>1,hasNextPage:l<a};this.pageData=w},scrollToBottom(){const{scrollContainer:o}=this.$refs;o.scrollIntoView({behavior:"smooth",block:"end"})},getCategory(){const o=new Set;Object.keys(this.productsData).forEach(t=>{const{category:n}=this.productsData[t];o.add(n)}),this.productsCategory=Array.from(o)},filterCategory(o){this.paginationData=[],Object.keys(this.productsData).forEach(t=>{const n=this.productsData[t];n.category===o&&this.paginationData.push(n)}),this.pagination(1)},searchProduct(){const o=[],t=this.searchInputValue.toLowerCase();Object.keys(this.productsData).forEach(n=>{this.productsData[n].title.toLowerCase().match(t)&&o.push(this.productsData[n])}),o.length===0&&this.showAlertMessage(!1,"很抱歉，沒有符合搜尋條件的產品"),this.paginationData=o,this.pagination(1)},...k(C,["pushToast"]),...k(O,["showAlertMessage"])},mounted(){this.getAdminProductsAll()}},Ze={key:1,class:"container"},$e={class:"row mt-4"},et={class:"col-8 d-flex"},tt={class:"btn-group me-3"},at={class:"dropdown-menu"},st=["onClick"],ot={class:"col-4 d-flex justify-content-end"},lt={key:1,class:"table mt-4 align-middle"},dt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),nt={scope:"row"},it=["src","alt"],ct={key:0,class:"text-main-spec fw-bold"},rt={key:1,class:"text-deep-gray"},ut={class:"d-flex justify-content-start align-items-center"},mt=["onClick"],pt=["onClick"],ht={class:"d-flex justify-content-center mt-4",ref:"scrollContainer"},gt={"aria-label":"Page navigation example"},_t={class:"pagination",id:"pageid"};function ft(o,t,n,h,a,l){const u=f("PageLoading"),m=f("status-message"),b=f("PageBtn"),w=f("ProductModal"),r=f("DeleteModal");return c(),p(M,null,[a.getRemoteData?(c(),p("div",Ze,[e("div",$e,[e("div",et,[e("div",tt,[a.productsData?(c(),p("button",{key:0,class:"btn btn-normal-dpgray dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:t[0]||(t[0]=(...s)=>l.getCategory&&l.getCategory(...s))}," 篩選類別 ")):T("",!0),e("ul",at,[(c(!0),p(M,null,A(a.productsCategory,(s,i)=>(c(),p("li",{key:i},[e("button",{class:"dropdown-item",href:"#",onClick:D=>l.filterCategory(s)},_(s),9,st)]))),128))])]),x(e("input",{class:"form-control form-control-sm",id:"exampleDataList",placeholder:"輸入產品名稱搜尋","onUpdate:modelValue":t[1]||(t[1]=s=>a.searchInputValue=s),onKeyup:t[2]||(t[2]=L((...s)=>l.searchProduct&&l.searchProduct(...s),["enter"]))},null,544),[[N,a.searchInputValue,void 0,{trim:!0}]]),e("button",{class:"btn btn-normal-dpgray",onClick:t[3]||(t[3]=(...s)=>l.searchProduct&&l.searchProduct(...s))},"搜")]),e("div",ot,[e("button",{type:"button",onClick:t[4]||(t[4]=(...s)=>l.scrollToBottom&&l.scrollToBottom(...s)),class:"btn"},"前往底部"),e("button",{class:"btn btn-solid-spec",onClick:t[5]||(t[5]=(...s)=>l.getAdminAddProductModal&&l.getAdminAddProductModal(...s))},"建立新的產品")])]),a.productsData.length===0?(c(),V(m,{key:0},{default:S(()=>[v(_("請點擊「建立新的產品」新增資料"))]),_:1})):(c(),p("table",lt,[dt,e("tbody",null,[(c(!0),p(M,null,A(a.infoData,(s,i)=>(c(),p("tr",{key:i},[e("th",nt,[e("img",{src:s.imageUrl,alt:s.title,class:"img-fluid",width:"50"},null,8,it)]),e("td",null,_(s.category),1),e("td",null,_(s.title),1),e("td",null,_(s.origin_price),1),e("td",null,_(s.price),1),e("td",null,[s.is_enabled===1?(c(),p("span",ct,"啟用")):(c(),p("span",rt,"未啟用"))]),e("td",null,[e("div",ut,[e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:D=>l.getAdminDelProductModal(s.id)}," 刪除 ",8,mt),e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:D=>l.getAdminProductModal(s.id)}," 編輯 ",8,pt)])])]))),128))])])),e("div",ht,[e("nav",gt,[e("ul",_t,[d(b,{"prev-is-enabled":a.pageData.hasPrevPage,onChangePrevPage:t[6]||(t[6]=s=>l.pagination(a.pageData.currentPage-1)),totalPage:a.pageData.totalPage,"current-page":a.pageData.currentPage,onChangePage:l.pagination,"next-is-enabled":a.pageData.hasNextPage,onChangeNextPage:t[7]||(t[7]=s=>l.pagination(a.pageData.currentPage+1))},null,8,["prev-is-enabled","totalPage","current-page","onChangePage","next-is-enabled"])])])],512)])):(c(),V(u,{key:0})),d(w,{ref:"productModal","show-data":a.showData,"in-edit-product-mode":a.inEditProductMode,onPutAdminProduct:l.putAdminProduct,onPostAdminProduct:l.postAdminProduct},null,8,["show-data","in-edit-product-mode","onPutAdminProduct","onPostAdminProduct"]),d(r,{ref:"deleteModal","show-data":a.showData,onDeleteFunction:l.deleteAdminProduct},null,8,["show-data","onDeleteFunction"])],64)}const Pt=U(Ye,[["render",ft]]);export{Pt as default};
