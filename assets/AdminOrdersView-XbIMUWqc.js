import{a as S,m as R,M as q,_ as I,I as L,o,c as d,b as e,f as c,g as A,t as r,d as _,F as k,r as T,n as v,w as j,L as F,e as g,h as f,q as U,i as J}from"./index-vSMGsHVG.js";import{t as V}from"./timeStore-5fwm0uwE.js";import{P as H}from"./PageBtn-tCV6EUDj.js";import{s as z}from"./stringStore-mamKbLwN.js";import{T as G}from"./TwoTabs-7hn7SeKH.js";import{D as K,S as Q}from"./StatusMessage-ZOVcQamq.js";var W={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:X,VITE_API_PATH:Y}=W,Z={data(){return{inEditOrderMode:!1,updatedShowData:{},showCreateAt:"",showPaidDate:"",showProductsArray:[],showOrderMessage:[],originalShowData:{},tabs:[{label:"訂單資訊"},{label:"訂購資訊"}]}},props:["showData"],emits:["order-updated"],components:{TwoTabs:G},methods:{putOrder(){const n=JSON.parse(JSON.stringify(this.updatedShowData)),a=Object.keys(n.products);let u=0;a.forEach(t=>{const l=n.products[t],p=l.product.price*l.qty,h={id:l.id,product_id:l.product_id,total:l.product.price*l.qty,final_total:p,qty:l.qty,product:l.product};l.coupon&&(h.final_total=Number.parseInt(p*l.coupon.percent/100,10),h.coupon=l.coupon),u+=h.final_total,n.products[t]=h}),n.total=u,n.paid_date===void 0&&n.is_paid===!0&&(n.paid_date=this.dayToTimestamp10Code(this.currentDate));const O=`${X}/v2/api/${Y}/admin/order/${n.id}`;this.$http.put(O,{data:n}).then(t=>{this.hideModal(),this.$emit("order-updated"),this.inEditOrderMode=!1,this.handleServerResponse(!0,t.data.message)}).catch(t=>{this.handleServerResponse(!1,t.response.data.message)})},editOrder(){this.originalShowData=JSON.parse(JSON.stringify(this.updatedShowData)),this.inEditOrderMode=!0},cancelChangeOrder(){this.updatedShowData=this.originalShowData,this.inEditOrderMode=!1},isPhone(n){return/^(09)[0-9]{8}$/.test(n)?!0:"請輸入正確的行動電話號碼"},openModal(){this.modal.show()},hideModal(){this.modal.hide()},handleServerResponse(n,a){const u=n?"bg-deep-gray":"bg-main-spec";this.pushToast({title:a,style:u})},...S(V,["dayToTimestamp10Code","timestamp10CodeToDay"]),...S(z,["splitStringByNewline"]),...S(L,["pushToast"])},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData)),this.showCreateAt=this.timestamp10CodeToDay(this.updatedShowData.create_at),this.showPaidDate=this.updatedShowData.is_paid?this.timestamp10CodeToDay(this.updatedShowData.paid_date):"",this.showOrderMessage=this.updatedShowData.message?this.splitStringByNewline(this.updatedShowData.message):[],this.showProductsArray=this.updatedShowData.products?Object.values(this.updatedShowData.products):[],this.inEditOrderMode=!1}},computed:{...R(V,["currentDate"])},mounted(){this.modal=new q(this.$refs.modal)}},$={ref:"modal",class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},ee={class:"modal-dialog modal-xl"},te={class:"modal-content"},se={class:"modal-header"},ae={class:"modal-title fs-5",id:"staticBackdropLabel"},oe={class:""},de={key:1,disabled:"",type:"button",class:"btn"},le={key:0,class:"modal-body"},ne={class:"row mt-3"},re={key:0,class:"col-8"},ie=e("h6",null,[e("strong",null,"收件人名稱")],-1),ce=e("h6",null,[e("strong",null,"電子信箱")],-1),ue=e("h6",null,[e("strong",null,"行動電話號碼")],-1),he=e("h6",null,[e("strong",null,"收件地址")],-1),pe=e("h6",null,[e("strong",null,"訂單備註")],-1),me={key:0},_e={key:1},ge={key:1,class:"col-8"},be={class:"mb-3"},fe=e("label",{for:"user_name",class:"form-label"},[g("收件人名稱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),we={class:"mb-3"},De=e("label",{for:"user_email",class:"form-label"},[g("電子信箱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ye={class:"mb-3"},Oe=e("label",{for:"user_tel",class:"form-label"},[g("行動電話號碼 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ve={class:"mb-3"},Se=e("label",{for:"user_address",class:"form-label"},[g("收件地址 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ke={class:"mb-3"},Me=e("label",{for:"message",class:"form-label"},"訂單備註",-1),Ae={class:"col-4"},Te={key:0},xe={key:0,class:"text-main-spec fw-bold"},Pe={key:1,class:"text-deep-gray"},Ce={key:1},Ee={class:"form-check"},Ve={for:"is_paid",class:"form-check-label"},Be={key:0,class:"text-main-spec fw-bold"},Ue={key:1,class:"text-deep-gray"},Ie={class:"table"},Le=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"類別"),e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"價格"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"},"總額"),e("th",{scope:"col"},"備註")])],-1),Ne=["src"],Re={key:0},qe={key:1},je=["src"],Fe=e("td",null,"...",-1),Je=e("td",null,"...",-1),He=e("td",null,"...",-1),ze={colspan:"8"},Ge={class:"float-end"},Ke={key:0,class:"fs-3"},Qe={key:1,class:"fs-2"},We={class:"modal-footer"},Xe={key:1,type:"submit",class:"btn btn-solid-spec"};function Ye(n,a,u,O,t,l){const p=f("vee-field"),h=f("vee-error-message"),x=f("TwoTabs"),P=f("vee-form");return o(),d("div",$,[e("div",ee,[e("div",te,[c(P,{onSubmit:l.putOrder},{default:A(({errors:b})=>[e("div",se,[e("h1",ae,r(t.updatedShowData.num)+"｜訂單編號："+r(t.updatedShowData.id),1),e("div",oe,[t.inEditOrderMode?_("",!0):(o(),d("button",{key:0,type:"button",class:"btn",onClick:a[0]||(a[0]=(...s)=>l.editOrder&&l.editOrder(...s))}," 編輯訂單 ")),t.inEditOrderMode?(o(),d("button",de,"編輯訂單中")):_("",!0),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[1]||(a[1]=(...s)=>l.cancelChangeOrder&&l.cancelChangeOrder(...s))})])]),t.updatedShowData.user?(o(),d("div",le,[c(x,{tabs:t.tabs},{0:A(()=>[e("div",ne,[t.inEditOrderMode?(o(),d("div",ge,[e("div",be,[fe,c(p,{type:"text",name:"收件人",class:v(["form-control",{"is-invalid":b.收件人}]),rules:"required|max:15",id:"user_name",placeholder:"請輸入收件人名稱",modelValue:t.updatedShowData.user.name,"onUpdate:modelValue":a[2]||(a[2]=s=>t.updatedShowData.user.name=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"收件人"})]),e("div",we,[De,c(p,{type:"email",class:v(["form-control",{"is-invalid":b.電子信箱}]),id:"user_email",rules:"email|required",name:"電子信箱",placeholder:"請輸入電子信箱",modelValue:t.updatedShowData.user.email,"onUpdate:modelValue":a[3]||(a[3]=s=>t.updatedShowData.user.email=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"電子信箱"})]),e("div",ye,[Oe,c(p,{type:"tel",name:"行動電話",rules:l.isPhone,class:v(["form-control",{"is-invalid":b.行動電話}]),id:"user_tel",placeholder:"請輸入行動電話號碼",modelValue:t.updatedShowData.user.tel,"onUpdate:modelValue":a[4]||(a[4]=s=>t.updatedShowData.user.tel=s)},null,8,["rules","class","modelValue"]),c(h,{class:"invalid-feedback",name:"行動電話"})]),e("div",ve,[Se,c(p,{type:"text",name:"收件地址",class:v(["form-control",{"is-invalid":b.收件地址}]),rules:"required|max:100",id:"user_address",placeholder:"請輸入收件地址",modelValue:t.updatedShowData.user.address,"onUpdate:modelValue":a[5]||(a[5]=s=>t.updatedShowData.user.address=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"收件地址"})]),e("div",ke,[Me,c(p,{as:"textarea",name:"訂單備註",type:"text",class:v(["form-control",{"is-invalid":b.訂單備註}]),id:"message",placeholder:"請輸入訂單備註",rules:"max:800",modelValue:t.updatedShowData.message,"onUpdate:modelValue":a[6]||(a[6]=s=>t.updatedShowData.message=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"訂單備註"})])])):(o(),d("div",re,[e("div",null,[ie,e("p",null,r(t.updatedShowData.user.name),1)]),e("div",null,[ce,e("p",null,r(t.updatedShowData.user.email),1)]),e("div",null,[ue,e("p",null,r(t.updatedShowData.user.tel),1)]),e("div",null,[he,e("p",null,r(t.updatedShowData.user.address),1)]),e("div",null,[pe,this.updatedShowData.message?(o(),d("div",me,[(o(!0),d(k,null,T(t.showOrderMessage,(s,m)=>(o(),d("p",{key:m},r(s),1))),128))])):(o(),d("p",_e,"無訂單備註"))])])),e("div",Ae,[t.inEditOrderMode?(o(),d("ul",Ce,[e("li",null,[e("p",null,r(t.showCreateAt)+" 創立",1)]),e("li",null,[e("div",Ee,[j(e("input",{type:"checkbox",class:"form-check-input",id:"is_paid","onUpdate:modelValue":a[7]||(a[7]=s=>t.updatedShowData.is_paid=s)},null,512),[[F,t.updatedShowData.is_paid]]),e("label",Ve,[t.updatedShowData.is_paid?(o(),d("span",Be,r(t.showPaidDate)+" 已付款",1)):(o(),d("span",Ue,"未付款"))])])])])):(o(),d("ul",Te,[e("li",null,[e("p",null,r(t.showCreateAt)+" 創立",1)]),e("li",null,[t.updatedShowData.is_paid?(o(),d("span",xe,r(t.showPaidDate)+" 已付款",1)):(o(),d("span",Pe,"未付款"))])]))])])]),1:A(()=>[e("table",Ie,[Le,e("tbody",null,[!t.inEditOrderMode&&t.updatedShowData.products?(o(!0),d(k,{key:0},T(t.showProductsArray,s=>{var m,w,D,y,i;return o(),d("tr",{key:s.id},[e("td",null,[e("img",{src:(m=s.product)==null?void 0:m.imageUrl,alt:"",width:"50"},null,8,Ne)]),e("td",null,r((w=s.product)==null?void 0:w.category),1),e("td",null,r((D=s.product)==null?void 0:D.title),1),e("td",null,[e("strong",null,r(s==null?void 0:s.qty),1)]),e("td",null,r((y=s.product)==null?void 0:y.price),1),e("td",null,r(s.total),1),e("td",null,[e("strong",null,r(s==null?void 0:s.final_total),1)]),e("td",null,[s.coupon?(o(),d("div",Re,[e("p",null,[g(" 使用 "),e("strong",null,r((i=s.coupon)==null?void 0:i.title),1),g(" 優惠券 ")]),e("p",null,[g(" 折扣"),e("strong",null,"-"+r(s.total-s.final_total),1),g("元 ")])])):(o(),d("span",qe,"無"))])])}),128)):(o(!0),d(k,{key:1},T(t.showProductsArray,s=>{var m,w,D,y,i,M,B;return o(),d("tr",{key:s.id},[e("td",null,[e("img",{src:(m=s.product)==null?void 0:m.imageUrl,alt:"",width:"50"},null,8,je)]),e("td",null,r((w=s.product)==null?void 0:w.category),1),e("td",null,r((D=s.product)==null?void 0:D.title),1),e("td",null,[c(p,{name:((y=s.product)==null?void 0:y.title)+"產品數量",class:v(["form-control",{"is-invalid":b[((i=s.product)==null?void 0:i.title)+"產品數量"]}]),rules:"required|numeric|integer|min_value:1",type:"text",modelValue:s.qty,"onUpdate:modelValue":N=>s.qty=N,modelModifiers:{number:!0}},null,8,["name","class","modelValue","onUpdate:modelValue"]),c(h,{class:"invalid-feedback",name:((M=s.product)==null?void 0:M.title)+"產品數量"},null,8,["name"])]),e("td",null,r((B=s.product)==null?void 0:B.price),1),Fe,Je,He])}),128))]),e("tfoot",null,[e("tr",null,[e("td",ze,[e("p",Ge,[g(" 訂單總金額：NT$ "),t.inEditOrderMode?(o(),d("strong",Qe," ... ")):(o(),d("strong",Ke,r(t.updatedShowData.total),1))])])])])])]),_:2},1032,["tabs"])])):_("",!0),e("div",We,[t.inEditOrderMode?(o(),d("button",{key:0,type:"button",class:"btn btn-normal-dpgray",onClick:a[8]||(a[8]=(...s)=>l.cancelChangeOrder&&l.cancelChangeOrder(...s))}," 取消 ")):_("",!0),t.inEditOrderMode?(o(),d("button",Xe,"更新")):_("",!0),t.inEditOrderMode?_("",!0):(o(),d("button",{key:2,type:"button",class:"btn btn-solid-spec",onClick:a[9]||(a[9]=(...s)=>l.hideModal&&l.hideModal(...s))}," 關閉 "))])]),_:1},8,["onSubmit"])])])],512)}const Ze=I(Z,[["render",Ye]]);var $e={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:C,VITE_API_PATH:E}=$e,et={data(){return{isLoading:!1,adminOrdersData:[],showData:{}}},components:{PageBtn:H,OrderModal:Ze,DeleteModal:K,StatusMessage:Q},computed:{},methods:{getOrderData(n){const a=this.adminOrdersData.orders.find(u=>u.id===n);this.showData=a,this.showData.title=`${this.showData.user.name}的訂單`},getAdminOrderModal(n){this.getOrderData(n),this.$refs.orderModal.openModal()},goToChangePage(n){this.getAdminOrders(n)},getAdminDelOrdersModal(){this.showData={title:"所有訂單"},this.$refs.deleteOrdersModal.openModal()},deleteAdminOrders(){const n=`${C}/v2/api/${E}/admin/orders/all`;this.$http.delete(n).then(a=>{this.getAdminOrders(),this.$refs.deleteOrdersModal.hideModal(),this.pushToast({title:a.data.message,style:"bg-deep-gray"})}).catch(a=>{this.showAlertMessage(!1,a.response.data.message)})},getAdminDelOrderModal(n){this.getOrderData(n),this.$refs.deleteOrderModal.openModal()},deleteAdminOrder(){const{id:n}=this.showData,a=`${C}/v2/api/${E}/admin/order/${n}`;this.$http.delete(a).then(u=>{this.getAdminOrders(),this.$refs.deleteOrderModal.hideModal(),this.pushToast({title:u.data.message,style:"bg-deep-gray"})}).catch(u=>{this.showAlertMessage(!1,u.response.data.message)})},getAdminOrders(n=1){const a=n.toString(),u=`${C}/v2/api/${E}/admin/orders`;this.$http.get(u,{params:{page:a}}).then(O=>{this.adminOrdersData=O.data,this.isLoading=!1}).catch(O=>{this.showAlertMessage(!1,O.response.data.message)})},...S(V,["dayToTimestamp10Code","timestamp10CodeToDay"]),...S(L,["pushToast"]),...S(J,["showAlertMessage"])},mounted(){this.isLoading=!0,this.getAdminOrders()}},tt={key:1,class:"container"},st={key:1,class:"row mt-4"},at={class:"col d-flex justify-content-end"},ot={key:2,class:"table mt-4"},dt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"創立日期"),e("th",{scope:"col"},"付款狀態"),e("th",{scope:"col"},"收件人名稱"),e("th",{scope:"col"},"電子信箱"),e("th",{scope:"col"},"行動電話號碼"),e("th",{scope:"col"},"收件地址"),e("th",{scope:"col"},"操作")])],-1),lt={scope:"row"},nt={key:0,class:"text-main-spec fw-bold"},rt={key:1,class:"text-deep-gray"},it={class:"d-flex justify-content-start align-items-center"},ct=["onClick"],ut=["onClick"],ht={key:3,class:"d-flex justify-content-center mt-4"},pt={"aria-label":"Page navigation example"},mt={class:"pagination",id:"pageid"};function _t(n,a,u,O,t,l){var s,m,w,D,y;const p=f("PageLoading"),h=f("StatusMessage"),x=f("PageBtn"),P=f("OrderModal"),b=f("DeleteModal");return o(),d(k,null,[t.isLoading?(o(),U(p,{key:0})):(o(),d("div",tt,[((s=t.adminOrdersData.orders)==null?void 0:s.length)===0?(o(),U(h,{key:0,class:"mt-4"},{default:A(()=>[g(r("需等待訂單進入。"))]),_:1})):_("",!0),((m=t.adminOrdersData.orders)==null?void 0:m.length)*((w=t.adminOrdersData.pagination)==null?void 0:w.total_pages)>1?(o(),d("div",st,[e("div",at,[e("button",{type:"button",class:"btn btn-solid-spec",onClick:a[0]||(a[0]=(...i)=>l.getAdminDelOrdersModal&&l.getAdminDelOrdersModal(...i))}," 刪除所有訂單 ")])])):_("",!0),((D=t.adminOrdersData.orders)==null?void 0:D.length)!==0?(o(),d("table",ot,[dt,e("tbody",null,[(o(!0),d(k,null,T(t.adminOrdersData.orders,i=>(o(),d("tr",{key:i.id},[e("th",lt,r(i.num),1),e("td",null,r(n.timestamp10CodeToDay(i.create_at)),1),e("td",null,[i.is_paid?(o(),d("span",nt,"已付款")):(o(),d("span",rt,"未付款"))]),e("td",null,r(i.user.name),1),e("td",null,r(i.user.email),1),e("td",null,r(i.user.tel),1),e("td",null,r(i.user.address),1),e("td",null,[e("div",it,[e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:M=>l.getAdminDelOrderModal(i.id)}," 刪除 ",8,ct),e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:M=>l.getAdminOrderModal(i.id)}," 查看 ",8,ut)])])]))),128))])])):_("",!0),t.adminOrdersData&&t.adminOrdersData.pagination&&((y=t.adminOrdersData.orders)==null?void 0:y.length)!==0?(o(),d("div",ht,[e("nav",pt,[e("ul",mt,[c(x,{"prev-is-enabled":t.adminOrdersData.pagination.has_pre,"next-is-enabled":t.adminOrdersData.pagination.has_next,totalPage:t.adminOrdersData.pagination.total_pages,"current-page":t.adminOrdersData.pagination.current_page,onChangePrevPage:a[1]||(a[1]=i=>l.getAdminOrders(t.adminOrdersData.pagination.current_page-1)),onChangeNextPage:a[2]||(a[2]=i=>l.getAdminOrders(t.adminOrdersData.pagination.current_page+1)),onChangePage:l.goToChangePage},null,8,["prev-is-enabled","next-is-enabled","totalPage","current-page","onChangePage"])])])])):_("",!0)])),c(P,{ref:"orderModal","show-data":t.showData,onOrderUpdated:l.getAdminOrders},null,8,["show-data","onOrderUpdated"]),c(b,{ref:"deleteOrderModal","show-data":t.showData,onDeleteFunction:l.deleteAdminOrder},null,8,["show-data","onDeleteFunction"]),c(b,{ref:"deleteOrdersModal","show-data":t.showData,onDeleteFunction:l.deleteAdminOrders},null,8,["show-data","onDeleteFunction"])],64)}const Ot=I(et,[["render",_t]]);export{Ot as default};
