import{a as v,m as R,M as J,_ as U,J as B,o,c as d,b as e,f as c,g as A,t as r,d as m,F as M,r as E,n as S,w as j,N as q,e as g,i as D,s as L,j as F}from"./index-hsfrgDbZ.js";import{t as x}from"./timeStore-HNaeKCH6.js";import{P as H}from"./PageBtn-Q0UXg0Fu.js";import{s as G}from"./stringStore-9FlS5_2e.js";import{T as z}from"./TwoTabs-f8vLDQEx.js";import{D as K,S as Y}from"./StatusMessage-LfNLVKTB.js";var Q={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",VITE_EMAILJS_SERVICE_ID:"service_akj018u",VITE_EMAILJS_TEMPLATE_ID_CONTACT_US:"template_o8blnrh",VITE_EMAILJS_PUBLIC_KEY:"aGG0jyz8scVC5nDvC",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:W,VITE_API_PATH:X}=Q,Z={data(){return{inEditOrderMode:!1,updatedShowData:{},showCreateAt:"",showPaidDate:"",showProductsArray:[],showOrderMessage:[],originalShowData:{},tabs:[{label:"訂單資訊"},{label:"訂購資訊"}]}},props:["showData"],emits:["order-updated"],components:{TwoTabs:z},methods:{putOrder(){const n=JSON.parse(JSON.stringify(this.updatedShowData)),a=Object.keys(n.products);let u=0;a.forEach(t=>{const l=n.products[t],p=l.product.price*l.qty,h={id:l.id,product_id:l.product_id,total:l.product.price*l.qty,final_total:p,qty:l.qty,product:l.product};l.coupon&&(h.final_total=Number.parseInt(p*l.coupon.percent/100,10),h.coupon=l.coupon),u+=h.final_total,n.products[t]=h}),n.total=u,n.paid_date===void 0&&n.is_paid===!0&&(n.paid_date=this.dayToTimestamp10Code(this.currentDate));const O=`${W}/v2/api/${X}/admin/order/${n.id}`;this.$http.put(O,{data:n}).then(t=>{this.hideModal(),this.$emit("order-updated"),this.inEditOrderMode=!1,this.handleServerResponse(!0,t.data.message)}).catch(t=>{this.handleServerResponse(!1,t.response.data.message)})},editOrder(){this.originalShowData=JSON.parse(JSON.stringify(this.updatedShowData)),this.inEditOrderMode=!0},cancelChangeOrder(){this.updatedShowData=this.originalShowData,this.inEditOrderMode=!1},isPhone(n){return/^(09)[0-9]{8}$/.test(n)?!0:"請輸入正確的行動電話號碼"},openModal(){this.modal.show()},hideModal(){this.modal.hide()},handleServerResponse(n,a){const u=n?"bg-deep-gray":"bg-main-spec";this.pushToast({title:a,style:u})},...v(x,["dayToTimestamp10Code","timestamp10CodeToDay"]),...v(G,["splitStringByNewline"]),...v(B,["pushToast"])},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData)),this.showCreateAt=this.timestamp10CodeToDay(this.updatedShowData.create_at),this.showPaidDate=this.updatedShowData.is_paid?this.timestamp10CodeToDay(this.updatedShowData.paid_date):"",this.showOrderMessage=this.updatedShowData.message?this.splitStringByNewline(this.updatedShowData.message):[],this.showProductsArray=this.updatedShowData.products?Object.values(this.updatedShowData.products):[],this.inEditOrderMode=!1}},computed:{...R(x,["currentDate"])},mounted(){this.modal=new J(this.$refs.modal)}},$={ref:"modal",class:"modal fade",id:"staticBackdrop","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},ee={class:"modal-dialog modal-xl"},te={class:"modal-content"},se={class:"modal-header"},ae={class:"modal-title fs-5",id:"staticBackdropLabel"},oe={class:""},de={key:1,disabled:"",type:"button",class:"btn"},le={key:0,class:"modal-body"},ne={class:"row mt-3"},re={key:0,class:"col-8"},ie=e("h6",null,[e("strong",null,"收件人名稱")],-1),ce=e("h6",null,[e("strong",null,"電子信箱")],-1),ue=e("h6",null,[e("strong",null,"行動電話號碼")],-1),he=e("h6",null,[e("strong",null,"收件地址")],-1),pe=e("h6",null,[e("strong",null,"訂單備註")],-1),_e={key:0},me={key:1},ge={key:1,class:"col-8"},be={class:"mb-3"},De=e("label",{for:"user_name",class:"form-label"},[g("收件人名稱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),fe={class:"mb-3"},we=e("label",{for:"user_email",class:"form-label"},[g("電子信箱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ye={class:"mb-3"},Oe=e("label",{for:"user_tel",class:"form-label"},[g("行動電話號碼 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Se={class:"mb-3"},ve=e("label",{for:"user_address",class:"form-label"},[g("收件地址 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Me={class:"mb-3"},ke=e("label",{for:"message",class:"form-label"},"訂單備註",-1),Ae={class:"col-4"},Ee={key:0},Te={key:0,class:"text-main-spec fw-bold"},Ce={key:1,class:"text-deep-gray"},Ve={key:1},Pe={class:"form-check"},xe={for:"is_paid",class:"form-check-label"},Ie={key:0,class:"text-main-spec fw-bold"},Le={key:1,class:"text-deep-gray"},Ue={class:"table"},Be=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"類別"),e("th",{scope:"col"},"名稱"),e("th",{scope:"col"},"數量"),e("th",{scope:"col"},"價格"),e("th",{scope:"col"},"小計"),e("th",{scope:"col"},"總額"),e("th",{scope:"col"},"備註")])],-1),Ne=["src"],Re={key:0},Je={key:1},je=["src"],qe=e("td",null,"...",-1),Fe=e("td",null,"...",-1),He=e("td",null,"...",-1),Ge={colspan:"8"},ze={class:"float-end"},Ke={key:0,class:"fs-3"},Ye={key:1,class:"fs-2"},Qe={class:"modal-footer"},We={key:1,type:"submit",class:"btn btn-solid-spec"};function Xe(n,a,u,O,t,l){const p=D("vee-field"),h=D("vee-error-message"),T=D("TwoTabs"),C=D("vee-form");return o(),d("div",$,[e("div",ee,[e("div",te,[c(C,{onSubmit:l.putOrder},{default:A(({errors:b})=>[e("div",se,[e("h1",ae,r(t.updatedShowData.num)+"｜訂單編號："+r(t.updatedShowData.id),1),e("div",oe,[t.inEditOrderMode?m("",!0):(o(),d("button",{key:0,type:"button",class:"btn",onClick:a[0]||(a[0]=(...s)=>l.editOrder&&l.editOrder(...s))}," 編輯訂單 ")),t.inEditOrderMode?(o(),d("button",de,"編輯訂單中")):m("",!0),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close",onClick:a[1]||(a[1]=(...s)=>l.cancelChangeOrder&&l.cancelChangeOrder(...s))})])]),t.updatedShowData.user?(o(),d("div",le,[c(T,{tabs:t.tabs},{0:A(()=>[e("div",ne,[t.inEditOrderMode?(o(),d("div",ge,[e("div",be,[De,c(p,{type:"text",name:"收件人",class:S(["form-control",{"is-invalid":b.收件人}]),rules:"required|max:15",id:"user_name",placeholder:"請輸入收件人名稱",modelValue:t.updatedShowData.user.name,"onUpdate:modelValue":a[2]||(a[2]=s=>t.updatedShowData.user.name=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"收件人"})]),e("div",fe,[we,c(p,{type:"email",class:S(["form-control",{"is-invalid":b.電子信箱}]),id:"user_email",rules:"email|required",name:"電子信箱",placeholder:"請輸入電子信箱",modelValue:t.updatedShowData.user.email,"onUpdate:modelValue":a[3]||(a[3]=s=>t.updatedShowData.user.email=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"電子信箱"})]),e("div",ye,[Oe,c(p,{type:"tel",name:"行動電話",rules:l.isPhone,class:S(["form-control",{"is-invalid":b.行動電話}]),id:"user_tel",placeholder:"請輸入行動電話號碼",modelValue:t.updatedShowData.user.tel,"onUpdate:modelValue":a[4]||(a[4]=s=>t.updatedShowData.user.tel=s)},null,8,["rules","class","modelValue"]),c(h,{class:"invalid-feedback",name:"行動電話"})]),e("div",Se,[ve,c(p,{type:"text",name:"收件地址",class:S(["form-control",{"is-invalid":b.收件地址}]),rules:"required|max:100",id:"user_address",placeholder:"請輸入收件地址",modelValue:t.updatedShowData.user.address,"onUpdate:modelValue":a[5]||(a[5]=s=>t.updatedShowData.user.address=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"收件地址"})]),e("div",Me,[ke,c(p,{as:"textarea",name:"訂單備註",type:"text",class:S(["form-control",{"is-invalid":b.訂單備註}]),id:"message",placeholder:"請輸入訂單備註",rules:"max:800",modelValue:t.updatedShowData.message,"onUpdate:modelValue":a[6]||(a[6]=s=>t.updatedShowData.message=s)},null,8,["class","modelValue"]),c(h,{class:"invalid-feedback",name:"訂單備註"})])])):(o(),d("div",re,[e("div",null,[ie,e("p",null,r(t.updatedShowData.user.name),1)]),e("div",null,[ce,e("p",null,r(t.updatedShowData.user.email),1)]),e("div",null,[ue,e("p",null,r(t.updatedShowData.user.tel),1)]),e("div",null,[he,e("p",null,r(t.updatedShowData.user.address),1)]),e("div",null,[pe,this.updatedShowData.message?(o(),d("div",_e,[(o(!0),d(M,null,E(t.showOrderMessage,(s,_)=>(o(),d("p",{key:_},r(s),1))),128))])):(o(),d("p",me,"無訂單備註"))])])),e("div",Ae,[t.inEditOrderMode?(o(),d("ul",Ve,[e("li",null,[e("p",null,r(t.showCreateAt)+" 創立",1)]),e("li",null,[e("div",Pe,[j(e("input",{type:"checkbox",class:"form-check-input",id:"is_paid","onUpdate:modelValue":a[7]||(a[7]=s=>t.updatedShowData.is_paid=s)},null,512),[[q,t.updatedShowData.is_paid]]),e("label",xe,[t.updatedShowData.is_paid?(o(),d("span",Ie,r(t.showPaidDate)+" 已付款",1)):(o(),d("span",Le,"未付款"))])])])])):(o(),d("ul",Ee,[e("li",null,[e("p",null,r(t.showCreateAt)+" 創立",1)]),e("li",null,[t.updatedShowData.is_paid?(o(),d("span",Te,r(t.showPaidDate)+" 已付款",1)):(o(),d("span",Ce,"未付款"))])]))])])]),1:A(()=>[e("table",Ue,[Be,e("tbody",null,[!t.inEditOrderMode&&t.updatedShowData.products?(o(!0),d(M,{key:0},E(t.showProductsArray,s=>{var _,f,w,y,i;return o(),d("tr",{key:s.id},[e("td",null,[e("img",{src:(_=s.product)==null?void 0:_.imageUrl,alt:"",width:"50"},null,8,Ne)]),e("td",null,r((f=s.product)==null?void 0:f.category),1),e("td",null,r((w=s.product)==null?void 0:w.title),1),e("td",null,[e("strong",null,r(s==null?void 0:s.qty),1)]),e("td",null,r((y=s.product)==null?void 0:y.price),1),e("td",null,r(s.total),1),e("td",null,[e("strong",null,r(s==null?void 0:s.final_total),1)]),e("td",null,[s.coupon?(o(),d("div",Re,[e("p",null,[g(" 使用 "),e("strong",null,r((i=s.coupon)==null?void 0:i.title),1),g(" 優惠券 ")]),e("p",null,[g(" 折扣"),e("strong",null,"-"+r(s.total-s.final_total),1),g("元 ")])])):(o(),d("span",Je,"無"))])])}),128)):(o(!0),d(M,{key:1},E(t.showProductsArray,s=>{var _,f,w,y,i,k,I;return o(),d("tr",{key:s.id},[e("td",null,[e("img",{src:(_=s.product)==null?void 0:_.imageUrl,alt:"",width:"50"},null,8,je)]),e("td",null,r((f=s.product)==null?void 0:f.category),1),e("td",null,r((w=s.product)==null?void 0:w.title),1),e("td",null,[c(p,{name:((y=s.product)==null?void 0:y.title)+"產品數量",class:S(["form-control",{"is-invalid":b[((i=s.product)==null?void 0:i.title)+"產品數量"]}]),rules:"required|numeric|integer|min_value:1",type:"text",modelValue:s.qty,"onUpdate:modelValue":N=>s.qty=N,modelModifiers:{number:!0}},null,8,["name","class","modelValue","onUpdate:modelValue"]),c(h,{class:"invalid-feedback",name:((k=s.product)==null?void 0:k.title)+"產品數量"},null,8,["name"])]),e("td",null,r((I=s.product)==null?void 0:I.price),1),qe,Fe,He])}),128))]),e("tfoot",null,[e("tr",null,[e("td",Ge,[e("p",ze,[g(" 訂單總金額：NT$ "),t.inEditOrderMode?(o(),d("strong",Ye," ... ")):(o(),d("strong",Ke,r(t.updatedShowData.total),1))])])])])])]),_:2},1032,["tabs"])])):m("",!0),e("div",Qe,[t.inEditOrderMode?(o(),d("button",{key:0,type:"button",class:"btn btn-normal-dpgray",onClick:a[8]||(a[8]=(...s)=>l.cancelChangeOrder&&l.cancelChangeOrder(...s))}," 取消 ")):m("",!0),t.inEditOrderMode?(o(),d("button",We,"更新")):m("",!0),t.inEditOrderMode?m("",!0):(o(),d("button",{key:2,type:"button",class:"btn btn-solid-spec",onClick:a[9]||(a[9]=(...s)=>l.hideModal&&l.hideModal(...s))}," 關閉 "))])]),_:1},8,["onSubmit"])])])],512)}const Ze=U(Z,[["render",Xe]]);var $e={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",VITE_EMAILJS_SERVICE_ID:"service_akj018u",VITE_EMAILJS_TEMPLATE_ID_CONTACT_US:"template_o8blnrh",VITE_EMAILJS_PUBLIC_KEY:"aGG0jyz8scVC5nDvC",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:V,VITE_API_PATH:P}=$e,et={data(){return{isLoading:!1,adminOrdersData:[],showData:{}}},components:{PageBtn:H,OrderModal:Ze,DeleteModal:K,StatusMessage:Y},computed:{},methods:{getOrderData(n){const a=this.adminOrdersData.orders.find(u=>u.id===n);this.showData=a,this.showData.title=`${this.showData.user.name}的訂單`},getAdminOrderModal(n){this.getOrderData(n),this.$refs.orderModal.openModal()},goToChangePage(n){this.getAdminOrders(n)},getAdminDelOrdersModal(){this.showData={title:"所有訂單"},this.$refs.deleteOrdersModal.openModal()},deleteAdminOrders(){const n=`${V}/v2/api/${P}/admin/orders/all`;this.$http.delete(n).then(a=>{this.getAdminOrders(),this.$refs.deleteOrdersModal.hideModal(),this.pushToast({title:a.data.message,style:"bg-deep-gray"})}).catch(a=>{this.showAlertMessage(!1,a.response.data.message)})},getAdminDelOrderModal(n){this.getOrderData(n),this.$refs.deleteOrderModal.openModal()},deleteAdminOrder(){const{id:n}=this.showData,a=`${V}/v2/api/${P}/admin/order/${n}`;this.$http.delete(a).then(u=>{this.getAdminOrders(),this.$refs.deleteOrderModal.hideModal(),this.pushToast({title:u.data.message,style:"bg-deep-gray"})}).catch(u=>{this.showAlertMessage(!1,u.response.data.message)})},getAdminOrders(n=1){const a=n.toString(),u=`${V}/v2/api/${P}/admin/orders`;this.$http.get(u,{params:{page:a}}).then(O=>{this.adminOrdersData=O.data,this.isLoading=!1}).catch(O=>{this.showAlertMessage(!1,O.response.data.message)})},...v(x,["dayToTimestamp10Code","timestamp10CodeToDay"]),...v(B,["pushToast"]),...v(F,["showAlertMessage"])},mounted(){this.isLoading=!0,this.getAdminOrders()}},tt={key:1,class:"container"},st={key:1,class:"row mt-4"},at={class:"col d-flex justify-content-end"},ot={key:2,class:"table mt-4"},dt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"創立日期"),e("th",{scope:"col"},"付款狀態"),e("th",{scope:"col"},"收件人名稱"),e("th",{scope:"col"},"電子信箱"),e("th",{scope:"col"},"行動電話號碼"),e("th",{scope:"col"},"收件地址"),e("th",{scope:"col"},"操作")])],-1),lt={scope:"row"},nt={key:0,class:"text-main-spec fw-bold"},rt={key:1,class:"text-deep-gray"},it={class:"d-flex justify-content-start align-items-center"},ct=["onClick"],ut=["onClick"],ht={key:3,class:"d-flex justify-content-center mt-4"},pt={"aria-label":"Page navigation example"},_t={class:"pagination",id:"pageid"};function mt(n,a,u,O,t,l){var s,_,f,w,y;const p=D("PageLoading"),h=D("StatusMessage"),T=D("PageBtn"),C=D("OrderModal"),b=D("DeleteModal");return o(),d(M,null,[t.isLoading?(o(),L(p,{key:0})):(o(),d("div",tt,[((s=t.adminOrdersData.orders)==null?void 0:s.length)===0?(o(),L(h,{key:0,class:"mt-4"},{default:A(()=>[g(r("需等待訂單進入。"))]),_:1})):m("",!0),((_=t.adminOrdersData.orders)==null?void 0:_.length)*((f=t.adminOrdersData.pagination)==null?void 0:f.total_pages)>1?(o(),d("div",st,[e("div",at,[e("button",{type:"button",class:"btn btn-solid-spec",onClick:a[0]||(a[0]=(...i)=>l.getAdminDelOrdersModal&&l.getAdminDelOrdersModal(...i))}," 刪除所有訂單 ")])])):m("",!0),((w=t.adminOrdersData.orders)==null?void 0:w.length)!==0?(o(),d("table",ot,[dt,e("tbody",null,[(o(!0),d(M,null,E(t.adminOrdersData.orders,i=>(o(),d("tr",{key:i.id},[e("th",lt,r(i.num),1),e("td",null,r(n.timestamp10CodeToDay(i.create_at)),1),e("td",null,[i.is_paid?(o(),d("span",nt,"已付款")):(o(),d("span",rt,"未付款"))]),e("td",null,r(i.user.name),1),e("td",null,r(i.user.email),1),e("td",null,r(i.user.tel),1),e("td",null,r(i.user.address),1),e("td",null,[e("div",it,[e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:k=>l.getAdminDelOrderModal(i.id)}," 刪除 ",8,ct),e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:k=>l.getAdminOrderModal(i.id)}," 查看 ",8,ut)])])]))),128))])])):m("",!0),t.adminOrdersData&&t.adminOrdersData.pagination&&((y=t.adminOrdersData.orders)==null?void 0:y.length)!==0?(o(),d("div",ht,[e("nav",pt,[e("ul",_t,[c(T,{"prev-is-enabled":t.adminOrdersData.pagination.has_pre,"next-is-enabled":t.adminOrdersData.pagination.has_next,totalPage:t.adminOrdersData.pagination.total_pages,"current-page":t.adminOrdersData.pagination.current_page,onChangePrevPage:a[1]||(a[1]=i=>l.getAdminOrders(t.adminOrdersData.pagination.current_page-1)),onChangeNextPage:a[2]||(a[2]=i=>l.getAdminOrders(t.adminOrdersData.pagination.current_page+1)),onChangePage:l.goToChangePage},null,8,["prev-is-enabled","next-is-enabled","totalPage","current-page","onChangePage"])])])])):m("",!0)])),c(C,{ref:"orderModal","show-data":t.showData,onOrderUpdated:l.getAdminOrders},null,8,["show-data","onOrderUpdated"]),c(b,{ref:"deleteOrderModal","show-data":t.showData,onDeleteFunction:l.deleteAdminOrder},null,8,["show-data","onDeleteFunction"]),c(b,{ref:"deleteOrdersModal","show-data":t.showData,onDeleteFunction:l.deleteAdminOrders},null,8,["show-data","onDeleteFunction"])],64)}const Ot=U(et,[["render",mt]]);export{Ot as default};
