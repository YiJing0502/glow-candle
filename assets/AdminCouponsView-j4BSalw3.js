import{m as x,M as E,_ as k,o as l,c as u,b as e,e as i,f as P,t as m,n as b,w as R,H as $,g as f,h as r,a as y,l as A,F as S,r as N,d as B}from"./index-b5Mq9qPg.js";import{t as M}from"./timeStore-ZePc6pQ3.js";import{S as O,D as J}from"./StatusMessage-Cqwc79SE.js";import{P as L}from"./PageBtn-bW9t-vCy.js";import{t as U}from"./toastsStore-4YbyuFGs.js";const F={data(){return{modal:"",updatedShowData:{}}},methods:{resetAddForm(){this.$refs.form.resetForm()},openModal(){this.modal.show()},hideModal(){this.modal.hide()},putAdminCoupon(){this.$emit("put-admin-coupon",this.updatedShowData)},postAdminCoupon(){this.$emit("post-admin-coupon",this.updatedShowData)}},computed:{...x(M,["currentDate"])},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},props:["inEditCouponMode","showData"],emits:["put-admin-coupon","post-admin-coupon"],mounted(){this.modal=new E(this.$refs.modal),this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},I={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true","data-bs-backdrop":"static","data-bs-keyboard":"false"},q={class:"modal-dialog modal-xl"},H={class:"modal-content"},j={class:"modal-header"},z={class:"modal-title fs-5",id:"exampleModalLabel"},G=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Q={class:"row"},W={class:"col-10"},X={class:"mb-3"},Y=e("label",{for:"coupon_title",class:"form-label"},[f("標題 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Z={class:"col-2 d-flex align-items-center"},ee={class:"form-check mt-3"},te={for:"is_enabled",class:"form-check-label"},oe={key:0,class:"text-main-spec fw-bold"},se={key:1,class:"text-deep-gray"},ae={class:"row"},ne={class:"col mb-3"},de=e("label",{for:"coupon_due_date",class:"form-label"},[f("到期日 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),le={class:"col mb-3"},ie=e("label",{for:"coupon_percent",class:"form-label"},[f("折扣 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ce={class:"col mb-3"},pe=e("label",{for:"coupon_code",class:"form-label"},[f("折扣代碼 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ue={class:"modal-footer"},re=e("button",{type:"button",class:"btn btn-normal-dpgray","data-bs-dismiss":"modal"}," 關閉 ",-1),me={type:"submit",class:"btn btn-solid-spec"};function he(s,t,a,n,o,d){const _=r("vee-field"),g=r("vee-error-message"),D=r("vee-form");return l(),u("div",I,[e("div",q,[e("div",H,[i(D,{ref:"form",onSubmit:t[5]||(t[5]=h=>a.inEditCouponMode?d.putAdminCoupon():d.postAdminCoupon())},{default:P(({errors:h})=>[e("div",j,[e("h1",z,m(a.inEditCouponMode?"編輯優惠券":"新增優惠券"),1),G]),e("div",K,[e("div",Q,[e("div",W,[e("div",X,[Y,i(_,{type:"text",name:"標題",class:b(["form-control",{"is-invalid":h.標題}]),rules:"required|max:100",id:"coupon_title",placeholder:"請輸入標題",modelValue:o.updatedShowData.title,"onUpdate:modelValue":t[0]||(t[0]=c=>o.updatedShowData.title=c)},null,8,["class","modelValue"]),i(g,{class:"invalid-feedback",name:"標題"})])]),e("div",Z,[e("div",ee,[R(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[1]||(t[1]=c=>o.updatedShowData.is_enabled=c)},null,512),[[$,o.updatedShowData.is_enabled]]),e("label",te,[o.updatedShowData.is_enabled===1?(l(),u("span",oe,"啟用")):(l(),u("span",se,"未啟用"))])])])]),e("div",ae,[e("div",ne,[de,i(_,{type:"date",name:"到期日",class:b(["form-control",{"is-invalid":h.到期日}]),rules:"required",id:"coupon_due_date",placeholder:"請輸入到期日",modelValue:o.updatedShowData.due_date,"onUpdate:modelValue":t[2]||(t[2]=c=>o.updatedShowData.due_date=c),min:s.currentDate},null,8,["class","modelValue","min"]),i(g,{class:"invalid-feedback",name:"到期日"})]),e("div",le,[ie,i(_,{type:"number",name:"折扣",class:b(["form-control",{"is-invalid":h.折扣}]),rules:"required|numeric|integer|min_value:1|max_value:100",id:"coupon_percent",placeholder:"請輸入折扣",modelValue:o.updatedShowData.percent,"onUpdate:modelValue":t[3]||(t[3]=c=>o.updatedShowData.percent=c)},null,8,["class","modelValue"]),i(g,{class:"invalid-feedback",name:"折扣"})]),e("div",ce,[pe,i(_,{type:"text",name:"折扣代碼",class:b(["form-control",{"is-invalid":h.折扣代碼}]),rules:"required|max:100",id:"coupon_code",placeholder:"請輸入折扣代碼",modelValue:o.updatedShowData.code,"onUpdate:modelValue":t[4]||(t[4]=c=>o.updatedShowData.code=c)},null,8,["class","modelValue"]),i(g,{class:"invalid-feedback",name:"折扣代碼"})])])]),e("div",ue,[re,e("button",me,m(a.inEditCouponMode?"更新":"新增"),1)])]),_:1},512)])])],512)}const _e=k(F,[["render",he]]);var ge={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:v,VITE_API_PATH:C}=ge,fe={data(){return{getRemoteData:!1,couponsData:[],pagination:{},showData:{},inEditCouponMode:!0,serverMessage:{message:"",success:!0}}},components:{StatusMessage:O,DeleteModal:J,CouponModal:_e,PageBtn:L},methods:{getAdminAddCouponModal(){this.inEditCouponMode=!1,this.showData={},this.$refs.couponModal.resetAddForm(),this.$refs.couponModal.openModal()},getAdminCouponModal(s){this.inEditCouponMode=!0,this.showData=JSON.parse(JSON.stringify(this.couponsData[s])),this.showData.due_date=this.timestamp10CodeToDay(this.showData.due_date),this.$refs.couponModal.openModal()},getAdminDeleCouponModal(s){this.showData=JSON.parse(JSON.stringify(this.couponsData[s])),this.$refs.deleteModal.openModal()},goToChangePage(s){this.getAdminCoupons(s)},getAdminCoupons(s=1){const t=s.toString(),a=`${v}/v2/api/${C}/admin/coupons`;this.$http.get(a,{params:{page:t}}).then(n=>{this.getRemoteData=n.data.success,this.couponsData=n.data.coupons,this.pagination=n.data.pagination}).catch(n=>{this.handleServerResponse(!1,n.response.data.message)})},postAdminCoupon(s){const t=`${v}/v2/api/${C}/admin/coupon`,a={data:s};a.data.due_date=this.dayToTimestamp10Code(s.due_date),a.data.is_enabled===void 0&&(a.data.is_enabled=2),this.$http.post(t,a).then(n=>{this.getAdminCoupons(),this.$refs.couponModal.hideModal(),this.pushToast({title:n.data.message,style:"bg-deep-gray"})}).catch(n=>{this.handleServerResponse(!1,n.response.data.message)})},putAdminCoupon(s){const{id:t}=s,a=`${v}/v2/api/${C}/admin/coupon/${t}`,n={data:s};n.data.due_date=this.dayToTimestamp10Code(s.due_date),this.$http.put(a,n).then(o=>{this.getAdminCoupons(),this.$refs.couponModal.hideModal(),this.pushToast({title:o.data.message,style:"bg-deep-gray"})}).catch(o=>{this.handleServerResponse(!1,o.response.data.message)})},deleteAdminCoupon(){const{id:s}=this.showData,t=`${v}/v2/api/${C}/admin/coupon/${s}`;this.$http.delete(t).then(a=>{this.getAdminCoupons(),this.$refs.deleteModal.hideModal(),this.pushToast({title:a.data.message,style:"bg-deep-gray"})}).catch(a=>{this.handleServerResponse(!1,a.response.data.message)})},handleServerResponse(s,t){this.serverMessage.success=s,this.serverMessage.message=t,this.$refs.resultModal.openModal()},couponsDueDateMessage(s){const t=this.dayToTimestamp10Code(this.currentDate),a=this.timestamp10CodeToDay(s);return s<t?`${a} (已過期)`:s>t?`${a}`:`${a} (今天過期)`},...y(M,["dayToTimestamp10Code","timestamp10CodeToDay"]),...y(U,["pushToast"])},computed:{...x(M,["currentDate"])},mounted(){this.getAdminCoupons()}},be={key:1,class:"container"},ve={class:"row mt-4"},Ce={class:"col d-flex justify-content-end"},De={key:1,class:"table mt-4 align-middle"},Me=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"代碼"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),we={key:0,class:"text-main-spec fw-bold"},ye={key:1,class:"text-deep-gray"},Ae=["onClick"],Se=["onClick"],xe={key:2,class:"d-flex justify-content-center mt-4"},ke={"aria-label":"Page navigation example"},Pe={class:"pagination",id:"pageid"};function Te(s,t,a,n,o,d){const _=r("PageLoading"),g=r("status-message"),D=r("PageBtn"),h=r("CouponModal"),c=r("DeleteModal"),T=r("ResultModal");return l(),u(S,null,[o.getRemoteData?(l(),u("div",be,[e("div",ve,[e("div",Ce,[e("button",{type:"button",class:"btn btn-solid-spec",onClick:t[0]||(t[0]=(...p)=>d.getAdminAddCouponModal&&d.getAdminAddCouponModal(...p))}," 建立新的優惠券 ")])]),o.couponsData.length===0?(l(),A(g,{key:0},{default:P(()=>[f(m("請點擊「建立新的優惠券」新增資料"))]),_:1})):(l(),u("table",De,[Me,e("tbody",null,[(l(!0),u(S,null,N(o.couponsData,(p,w)=>(l(),u("tr",{key:p.id},[e("th",null,m(p.num),1),e("th",null,m(p.title),1),e("td",null,m(p.percent),1),e("td",null,m(d.couponsDueDateMessage(p.due_date)),1),e("td",null,m(p.code),1),e("td",null,[p.is_enabled===1?(l(),u("span",we,"啟用")):(l(),u("span",ye,"未啟用"))]),e("td",null,[e("button",{type:"button",class:"btn btn-sm btn-normal-medium block w-50",onClick:V=>d.getAdminDeleCouponModal(w)}," 刪除 ",8,Ae),e("button",{type:"button",class:"btn btn-sm btn-normal-medium block w-50",onClick:V=>d.getAdminCouponModal(w)}," 編輯 ",8,Se)])]))),128))])])),o.pagination&&o.pagination.current_page?(l(),u("div",xe,[e("nav",ke,[e("ul",Pe,[i(D,{"prev-is-enabled":o.pagination.has_pre,"next-is-enabled":o.pagination.has_next,totalPage:o.pagination.total_pages,"current-page":o.pagination.current_page,onChangePrevPage:t[1]||(t[1]=p=>d.getAdminCoupons(o.pagination.current_page-1)),onChangeNextPage:t[2]||(t[2]=p=>d.getAdminCoupons(o.pagination.current_page+1)),onChangePage:d.goToChangePage},null,8,["prev-is-enabled","next-is-enabled","totalPage","current-page","onChangePage"])])])])):B("",!0)])):(l(),A(_,{key:0})),i(h,{ref:"couponModal","in-edit-coupon-mode":o.inEditCouponMode,"show-data":o.showData,onPostAdminCoupon:d.postAdminCoupon,onPutAdminCoupon:d.putAdminCoupon},null,8,["in-edit-coupon-mode","show-data","onPostAdminCoupon","onPutAdminCoupon"]),i(c,{ref:"deleteModal","show-data":o.showData,onDeleteFunction:d.deleteAdminCoupon},null,8,["show-data","onDeleteFunction"]),i(T,{ref:"resultModal","server-message":o.serverMessage},null,8,["server-message"])],64)}const Be=k(fe,[["render",Te]]);export{Be as default};
