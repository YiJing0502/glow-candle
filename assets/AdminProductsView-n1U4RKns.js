import{_ as A,R as E,M as I,o as r,c,a as e,t as g,l as p,v as m,p as V,F as b,j as w,e as x,b as v,r as _,n as k,m as B,f as U,q as R,w as T,d as O}from"./index-zAkwafHT.js";import{a as L}from"./adminStore-FNiF12-c.js";import{D as N,S as j}from"./StatusMessage-bz1X1dGY.js";var $={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:F,VITE_API_PATH:J}=$,H={data(){return{modal:"",updatedShowData:{},serverMessage:{message:"",success:!0}}},components:{ResultModal:E},mounted(){this.modal=new I(this.$refs.modal),this.updatedShowData=JSON.parse(JSON.stringify(this.showData))},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},methods:{openModal(){this.modal.show()},hideModal(){this.modal.hide()},putAdminProduct(){this.$emit("put-admin-product",this.updatedShowData)},postAdminProduct(){this.$emit("post-admin-product",this.updatedShowData)},deleteImage(a){let t=[...this.updatedShowData.imagesUrl];t=t.filter((o,i)=>i!==a),this.updatedShowData.imagesUrl=t},addImage(){this.updatedShowData.imagesUrl===void 0?this.updatedShowData.imagesUrl=[""]:this.updatedShowData.imagesUrl.push("")},validateImages(a){for(let t=0;t<a.length;t+=1){const o=a[t],i=o.size,s=3*1024*1024;if(i>s)return this.serverMessage.message="圖片檔案不可超過3MB",this.serverMessage.success=!1,this.$refs.resultModal.openModal(),!1;if(o.type!=="image/jpeg"&&o.type!=="image/jpg"&&o.type!=="image/png")return this.serverMessage.message="只接收「jpg」、「jpeg」、「png」類型的圖片檔案",this.serverMessage.success=!1,this.$refs.resultModal.openModal(),!1}return!0},uploadImages(a){const t=[...a.target.files];this.validateImages(t)&&t.forEach(o=>{const i=new FormData;i.append("file-to-upload",o),this.$http.post(`${F}/api/${J}/admin/upload`,i).then(s=>{s.data.success?(this.updatedShowData.imagesUrl===void 0?(this.updatedShowData.imagesUrl=[],this.updatedShowData.imagesUrl.push(s.data.imageUrl)):this.updatedShowData.imagesUrl.push(s.data.imageUrl),this.serverMessage.message=s.data.success,this.serverMessage.success="上傳成功",this.$refs.resultModal.openModal()):(this.serverMessage.success=s.data.success,this.serverMessage.message="上傳成功",this.$refs.resultModal.openModal()),this.$refs.uploadInput.value=""}).catch(s=>{this.serverMessage.message=s.response.data.message,this.serverMessage.success=s.response.data.success,this.$refs.resultModal.openModal(),this.$refs.uploadInput.value=""})})}},props:["showData","inEditProductMode"],emits:["upload-images","delete-image","add-image","put-admin-product","post-admin-product"]},z={class:"modal fade",ref:"modal","data-bs-backdrop":"static","data-bs-keyboard":"false",tabindex:"-1","aria-labelledby":"staticBackdropLabel","aria-hidden":"true"},q={class:"modal-dialog modal-xl"},K={class:"modal-content"},G={class:"modal-header"},Q={class:"modal-title fs-5",id:"staticBackdropLabel"},W=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),X={class:"modal-body"},Y=e("nav",null,[e("div",{class:"nav nav-tabs",id:"nav-tab",role:"tablist"},[e("button",{class:"nav-link active w-50",id:"nav-home-tab","data-bs-toggle":"tab","data-bs-target":"#nav-home",type:"button",role:"tab","aria-controls":"nav-home","aria-selected":"true"},"商品內容"),e("button",{class:"nav-link w-50",id:"nav-profile-tab","data-bs-toggle":"tab","data-bs-target":"#nav-profile",type:"button",role:"tab","aria-controls":"nav-profile","aria-selected":"false"},"商品圖片")])],-1),Z={class:"tab-content",id:"nav-tabContent"},ee={class:"tab-pane fade show active",id:"nav-home",role:"tabpanel","aria-labelledby":"nav-home-tab",tabindex:"0"},te={class:"row mt-3"},se={class:"row"},ae={class:"col-10"},oe={class:"mb-3"},le=e("label",{for:"title",class:"form-label"},"標題",-1),de={class:"col-2 d-flex align-items-center"},ne={class:"form-check mt-3"},ie={for:"is_enabled",class:"form-check-label"},re={key:0,class:"text-main-spec fw-bold"},ce={key:1,class:"text-deep-gray"},ue={class:"row"},pe={class:"mb-3 col"},he=e("label",{for:"category",class:"form-label"},"分類",-1),me={class:"mb-3 col"},ge=e("label",{for:"unit",class:"form-label"},"單位",-1),_e={class:"row"},be={class:"mb-3 col"},fe=e("label",{for:"original_price",class:"form-label"},"原價",-1),ve={class:"mb-3 col"},De=e("label",{for:"price",class:"form-label"},"售價",-1),Me={class:"row"},we={class:"mb-3 col"},Pe=e("label",{for:"cost_price",class:"form-label"},"成本價",-1),ye={class:"mb-3 col"},Se=e("label",{for:"inventory",class:"form-label"},"庫存量",-1),ke={class:"row"},Ae={class:"col"},Ce={class:"mb-3"},Ue=e("label",{for:"description",class:"form-label"},"產品描述",-1),xe={class:"col"},Ee={class:"mb-3"},Ie=e("label",{for:"content",class:"form-label"},"說明內容",-1),Ve={class:"tab-pane fade",id:"nav-profile",role:"tabpanel","aria-labelledby":"nav-profile-tab",tabindex:"0"},Be={class:"row row-cols-4 mt-3"},Re={class:"col mb-3"},Te={class:"mb-3"},Oe=e("label",{for:"imageUrl",class:"form-label"},"輸入主要圖片網址",-1),Le=["src","alt"],Ne={class:"mb-3"},je=e("label",{for:"imageUrl",class:"form-label"},"輸入其他圖片網址",-1),$e=["onClick"],Fe=["onUpdate:modelValue"],Je=["src","alt"],He={class:"col mb-3"},ze={class:"card"},qe={class:"card-body"},Ke=e("label",{for:"formFile",class:"form-label"},"上傳圖片檔案",-1),Ge=e("hr",null,null,-1),Qe={class:"modal-footer"},We=e("button",{type:"button",class:"btn btn-normal-dpgray","data-bs-dismiss":"modal"},"關閉",-1);function Xe(a,t,o,i,s,l){const u=_("ResultModal");return r(),c(b,null,[e("div",z,[e("div",q,[e("div",K,[e("div",G,[e("h1",Q,g(o.inEditProductMode?"編輯產品":"新增產品"),1),W]),e("div",X,[Y,e("div",Z,[e("div",ee,[e("div",te,[e("div",se,[e("div",ae,[e("div",oe,[le,p(e("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":t[0]||(t[0]=d=>s.updatedShowData.title=d)},null,512),[[m,s.updatedShowData.title]])])]),e("div",de,[e("div",ne,[p(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[1]||(t[1]=d=>s.updatedShowData.is_enabled=d)},null,512),[[V,s.updatedShowData.is_enabled]]),e("label",ie,[s.updatedShowData.is_enabled===1?(r(),c("span",re,"啟用")):(r(),c("span",ce,"未啟用"))])])])]),e("div",ue,[e("div",pe,[he,p(e("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入分類","onUpdate:modelValue":t[2]||(t[2]=d=>s.updatedShowData.category=d)},null,512),[[m,s.updatedShowData.category]])]),e("div",me,[ge,p(e("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":t[3]||(t[3]=d=>s.updatedShowData.unit=d)},null,512),[[m,s.updatedShowData.unit]])])]),e("div",_e,[e("div",be,[fe,p(e("input",{type:"number",class:"form-control",id:"original_price",placeholder:"請輸入原價","onUpdate:modelValue":t[4]||(t[4]=d=>s.updatedShowData.origin_price=d)},null,512),[[m,s.updatedShowData.origin_price,void 0,{number:!0}]])]),e("div",ve,[De,p(e("input",{type:"number",class:"form-control",id:"price",placeholder:"請輸入售價","onUpdate:modelValue":t[5]||(t[5]=d=>s.updatedShowData.price=d)},null,512),[[m,s.updatedShowData.price,void 0,{number:!0}]])])]),e("div",Me,[e("div",we,[Pe,p(e("input",{type:"number",class:"form-control",id:"cost_price",placeholder:"請輸入成本價","onUpdate:modelValue":t[6]||(t[6]=d=>s.updatedShowData.cost_price=d)},null,512),[[m,s.updatedShowData.cost_price,void 0,{number:!0}]])]),e("div",ye,[Se,p(e("input",{type:"number",class:"form-control",id:"inventory",placeholder:"請輸入庫存量","onUpdate:modelValue":t[7]||(t[7]=d=>s.updatedShowData.inventory=d)},null,512),[[m,s.updatedShowData.inventory,void 0,{number:!0}]])])]),e("div",ke,[e("div",Ae,[e("div",Ce,[Ue,p(e("textarea",{class:"form-control",id:"description",rows:"3","onUpdate:modelValue":t[8]||(t[8]=d=>s.updatedShowData.description=d)},null,512),[[m,s.updatedShowData.description]])])]),e("div",xe,[e("div",Ee,[Ie,p(e("textarea",{class:"form-control",id:"content",rows:"3","onUpdate:modelValue":t[9]||(t[9]=d=>s.updatedShowData.content=d)},null,512),[[m,s.updatedShowData.content]])])])])])]),e("div",Ve,[e("div",Be,[e("div",Re,[e("div",Te,[Oe,p(e("input",{type:"text",class:"form-control",placeholder:"請輸入主要圖片連結","onUpdate:modelValue":t[10]||(t[10]=d=>s.updatedShowData.imageUrl=d)},null,512),[[m,s.updatedShowData.imageUrl]])]),e("img",{src:s.updatedShowData.imageUrl,alt:s.updatedShowData.title,class:"img-fluid"},null,8,Le)]),(r(!0),c(b,null,w(s.updatedShowData.imagesUrl,(d,h)=>(r(),c("div",{class:"col mb-3",key:h},[e("div",Ne,[je,e("button",{type:"button",class:"btn-close float-end","aria-label":"Close",onClick:f=>l.deleteImage(h)},null,8,$e),p(e("input",{type:"text",class:"form-control",placeholder:"請輸入其他圖片連結","onUpdate:modelValue":f=>s.updatedShowData.imagesUrl[h]=f},null,8,Fe),[[m,s.updatedShowData.imagesUrl[h]]])]),s.updatedShowData.imagesUrl[h]?(r(),c("img",{key:0,src:s.updatedShowData.imagesUrl[h],alt:s.updatedShowData.title+h,class:"img-fluid"},null,8,Je)):x("",!0)]))),128)),e("div",He,[e("div",ze,[e("div",qe,[Ke,e("input",{class:"form-control",type:"file",name:"fileInput",onChange:t[11]||(t[11]=(...d)=>l.uploadImages&&l.uploadImages(...d)),ref:"uploadInput",accept:"image/jpeg, image/jpg, image/png",multiple:""},null,544),Ge,e("button",{class:"btn btn-solid-dpgray w-100",onClick:t[12]||(t[12]=(...d)=>l.addImage&&l.addImage(...d))},"手動新增圖片")])])])])])])]),e("div",Qe,[We,e("button",{type:"button",class:"btn btn-solid-spec",onClick:t[13]||(t[13]=d=>o.inEditProductMode?l.putAdminProduct():l.postAdminProduct())},g(o.inEditProductMode?"更新":"新增"),1)])])])],512),v(u,{ref:"resultModal","server-message":s.serverMessage},null,8,["server-message"])],64)}const Ye=A(H,[["render",Xe]]),Ze={props:["totalPage","currentPage","nextIsEnabled","prevIsEnabled"],emits:["change-page","change-prev-page","change-next-page"]},et={class:"page-item"},tt=["data-page","onClick"],st={class:"page-item"};function at(a,t,o,i,s,l){return r(),c(b,null,[e("li",et,[e("button",{type:"button",class:k(["page-link",{disabled:!o.prevIsEnabled}]),onClick:t[0]||(t[0]=u=>a.$emit("change-prev-page"))},"Previous",2)]),(r(!0),c(b,null,w(o.totalPage,u=>(r(),c("li",{key:u,class:"page-item"},[e("button",{type:"button",class:k(["page-link",{active:o.currentPage==u}]),"data-page":u,onClick:d=>a.$emit("change-page",u)},g(u),11,tt)]))),128)),e("li",st,[e("button",{type:"button",class:k(["page-link",{disabled:!o.nextIsEnabled}]),onClick:t[1]||(t[1]=u=>a.$emit("change-next-page"))},"Next",2)])],64)}const ot=A(Ze,[["render",at]]);var lt={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:D,VITE_API_PATH:M}=lt,dt={data(){return{getRemoteData:!1,productsData:[],paginationData:[],pageData:{},infoData:[],showData:{},inEditProductMode:!0,serverMessage:{message:"",success:!0},productsCategory:[],searchInputValue:""}},components:{DeleteModal:N,ProductModal:Ye,StatusMessage:j,PageBtn:ot},computed:{...B(L,["loginSuccess"])},methods:{getAdminProductModal(a){this.inEditProductMode=!0,this.showData=JSON.parse(JSON.stringify(this.productsData[a])),this.$refs.productModal.openModal()},getAdminAddProductModal(){this.inEditProductMode=!1,this.showData={imagesUrl:[""]},this.$refs.productModal.openModal()},getAdminDelProductModal(a){this.showData=JSON.parse(JSON.stringify(this.productsData[a])),this.$refs.deleteModal.openModal()},getAdminProductsAll(){const a=`${D}/v2/api/${M}/admin/products/all`;this.$http.get(a).then(t=>{t.data.success&&(this.getRemoteData=t.data.success,this.productsData=t.data.products,this.paginationData=t.data.products,this.pagination(1))}).catch(t=>{this.serverMessage.message=t.response.data.message,this.serverMessage.success=t.response.data.success,this.$refs.resultModal.openModal()})},postAdminProduct(a){const t=`${D}/v2/api/${M}/admin/product`,o={data:a};this.$http.post(t,o).then(i=>{this.getAdminProductsAll(),this.serverMessage.message=i.data.message,this.serverMessage.success=i.data.success,this.$refs.productModal.hideModal(),this.$refs.resultModal.openModal()}).catch(i=>{this.serverMessage.message=i.response.data.message,this.serverMessage.success=i.response.data.success,this.$refs.resultModal.openModal()})},putAdminProduct(a){const{id:t}=a,o=`${D}/v2/api/${M}/admin/product/${t}`,i={data:a};this.$http.put(o,i).then(s=>{s.data.success&&(this.getAdminProductsAll(),this.serverMessage.message=s.data.message,this.serverMessage.success=s.data.success,this.$refs.productModal.hideModal(),this.$refs.resultModal.openModal())}).catch(s=>{this.serverMessage.message=s.response.data.message,this.serverMessage.success=s.response.data.success,this.$refs.resultModal.openModal()})},deleteAdminProduct(){const{id:a}=this.showData,t=`${D}/v2/api/${M}/admin/product/${a}`;this.$http.delete(t).then(o=>{o.data.success&&(this.$refs.deleteModal.hideModal(),this.getAdminProductsAll(),this.serverMessage.message=o.data.message,this.serverMessage.success=o.data.success,this.$refs.resultModal.openModal())}).catch(o=>{this.$refs.deleteModal.hideModal(),this.serverMessage.message=o.response.data.message,this.serverMessage.success=o.response.data.success,this.$refs.resultModal.openModal()})},pagination(a){const t=this.paginationData,o=Object.keys(t).length,i=10,s=Math.ceil(o/i);let l=a;l>s&&(l=s);const u=l*i-i+1,d=l*i,h=[];Object.keys(t).forEach((P,y)=>{const n=y+1;n>=u&&n<=d&&h.push(t[P])}),this.infoData=h;const f={totalPage:s,currentPage:l,hasPrevPage:l>1,hasNextPage:l<s};this.pageData=f},scrollToBottom(){const{scrollContainer:a}=this.$refs;a.scrollIntoView({behavior:"smooth",block:"end"})},getCategory(){const a=new Set;Object.keys(this.productsData).forEach(t=>{const{category:o}=this.productsData[t];a.add(o)}),this.productsCategory=Array.from(a)},filterCategory(a){this.paginationData=[],Object.keys(this.productsData).forEach(t=>{const o=this.productsData[t];o.category===a&&this.paginationData.push(o)}),this.pagination(1)},searchProduct(){const a=[],t=this.searchInputValue.toLowerCase();Object.keys(this.productsData).forEach(o=>{this.productsData[o].title.toLowerCase().match(t)&&a.push(this.productsData[o])}),a.length===0&&(this.serverMessage.message="很抱歉，沒有符合搜尋條件的產品",this.serverMessage.success=!1,this.$refs.resultModal.openModal()),this.paginationData=a,this.pagination(1)}},mounted(){this.loginSuccess&&this.getAdminProductsAll()}},nt={key:1,class:"container"},it={class:"row mt-4"},rt={class:"col-8 d-flex"},ct={class:"btn-group me-3"},ut={class:"dropdown-menu"},pt=["onClick"],ht={class:"col-4 d-flex justify-content-end"},mt={key:1,class:"table mt-4 align-middle"},gt=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"圖片"),e("th",{scope:"col"},"分類"),e("th",{scope:"col"},"產品名稱"),e("th",{scope:"col"},"原價"),e("th",{scope:"col"},"售價"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),_t={scope:"row"},bt=["src","alt"],ft={key:0,class:"text-main-spec fw-bold"},vt={key:1,class:"text-deep-gray"},Dt={class:"d-flex justify-content-start align-items-center"},Mt=["onClick"],wt=["onClick"],Pt={class:"d-flex justify-content-center mt-4",ref:"scrollContainer"},yt={"aria-label":"Page navigation example"},St={class:"pagination",id:"pageid"};function kt(a,t,o,i,s,l){const u=_("VueLoading"),d=_("status-message"),h=_("PageBtn"),f=_("ProductModal"),P=_("DeleteModal"),y=_("ResultModal");return r(),c(b,null,[s.getRemoteData?(r(),c("div",nt,[e("div",it,[e("div",rt,[e("div",ct,[s.productsData?(r(),c("button",{key:0,class:"btn btn-normal-dpgray dropdown-toggle",type:"button","data-bs-toggle":"dropdown","aria-expanded":"false",onClick:t[0]||(t[0]=(...n)=>l.getCategory&&l.getCategory(...n))}," 篩選類別 ")):x("",!0),e("ul",ut,[(r(!0),c(b,null,w(s.productsCategory,(n,S)=>(r(),c("li",{key:S},[e("button",{class:"dropdown-item",href:"#",onClick:C=>l.filterCategory(n)},g(n),9,pt)]))),128))])]),p(e("input",{class:"form-control form-control-sm",id:"exampleDataList",placeholder:"輸入產品名稱搜尋","onUpdate:modelValue":t[1]||(t[1]=n=>s.searchInputValue=n),onKeyup:t[2]||(t[2]=R((...n)=>l.searchProduct&&l.searchProduct(...n),["enter"]))},null,544),[[m,s.searchInputValue,void 0,{trim:!0}]]),e("button",{class:"btn btn-normal-dpgray",onClick:t[3]||(t[3]=(...n)=>l.searchProduct&&l.searchProduct(...n))},"搜")]),e("div",ht,[e("button",{type:"button",onClick:t[4]||(t[4]=(...n)=>l.scrollToBottom&&l.scrollToBottom(...n)),class:"btn"},"前往底部"),e("button",{class:"btn btn-solid-spec",onClick:t[5]||(t[5]=(...n)=>l.getAdminAddProductModal&&l.getAdminAddProductModal(...n))}," 建立新的產品 ")])]),s.productsData.length===0?(r(),U(d,{key:0},{default:T(()=>[O(g("建立新的產品"))]),_:1})):(r(),c("table",mt,[gt,e("tbody",null,[(r(!0),c(b,null,w(s.infoData,(n,S)=>(r(),c("tr",{key:S},[e("th",_t,[e("img",{src:n.imageUrl,alt:n.title,class:"img-fluid",width:"50"},null,8,bt)]),e("td",null,g(n.category),1),e("td",null,g(n.title),1),e("td",null,g(n.origin_price),1),e("td",null,g(n.price),1),e("td",null,[n.is_enabled===1?(r(),c("span",ft,"啟用")):(r(),c("span",vt,"未啟用"))]),e("td",null,[e("div",Dt,[e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:C=>l.getAdminDelProductModal(n.id)}," 刪除 ",8,Mt),e("button",{class:"btn btn-sm btn-normal-medium block w-50",type:"button",onClick:C=>l.getAdminProductModal(n.id)}," 編輯 ",8,wt)])])]))),128))])])),e("div",Pt,[e("nav",yt,[e("ul",St,[v(h,{"prev-is-enabled":s.pageData.hasPrevPage,onChangePrevPage:t[6]||(t[6]=n=>l.pagination(s.pageData.currentPage-1)),totalPage:s.pageData.totalPage,"current-page":s.pageData.currentPage,onChangePage:l.pagination,"next-is-enabled":s.pageData.hasNextPage,onChangeNextPage:t[7]||(t[7]=n=>l.pagination(s.pageData.currentPage+1))},null,8,["prev-is-enabled","totalPage","current-page","onChangePage","next-is-enabled"])])])],512)])):(r(),U(u,{key:0,active:!s.getRemoteData,"background-color":"#FBFAF4",color:"#52504B"},null,8,["active"])),v(f,{ref:"productModal","show-data":s.showData,"in-edit-product-mode":s.inEditProductMode,onPutAdminProduct:l.putAdminProduct,onPostAdminProduct:l.postAdminProduct},null,8,["show-data","in-edit-product-mode","onPutAdminProduct","onPostAdminProduct"]),v(P,{ref:"deleteModal","show-data":s.showData,onDeleteFunction:l.deleteAdminProduct},null,8,["show-data","onDeleteFunction"]),v(y,{ref:"resultModal","server-message":s.serverMessage},null,8,["server-message"])],64)}const xt=A(dt,[["render",kt]]);export{xt as default};
