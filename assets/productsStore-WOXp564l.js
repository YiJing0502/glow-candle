import{K as D,L as l}from"./index-hsfrgDbZ.js";var P={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",VITE_EMAILJS_SERVICE_ID:"service_akj018u",VITE_EMAILJS_TEMPLATE_ID_CONTACT_US:"template_o8blnrh",VITE_EMAILJS_PUBLIC_KEY:"aGG0jyz8scVC5nDvC",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:u,VITE_API_PATH:g}=P,_=D("productsStore",{state:()=>({productsData:[],showProductsData:[],isLoading:!1,productPagesData:{},productsCategory:[],productsPageStatus:"全部產品",uniqueSeriesArray:[],uniqueTonesArray:[],uniqueCapacitiesArray:[],candlesData:[],calmSeriesProducts:["-NoLTSCPuUQGarWezIAl","-NoLWB8MDGIYr9flJ0Pb","-NoLWTOY-q1QXZOnQmEN","-NoLWnut3G93WzfuedRW"],bestsellers:["-NoLXYH97x33NA7DUGnQ","-NoLY64ZdZ5tKG0MYgXk","-NoL_80KGaePj1gdr6Gp","-NoLRz5ol1emgz6xq7j0"],calmSeriesBundle:{},bestsellersData:[],calmSeriesData:[],recommendationsData:[]}),getters:{},actions:{getProductsAll(t=!1,e=1){this.isLoading=!0;const s=`${u}/v2/api/${g}/products/all`;return new Promise((o,i)=>{l.get(s).then(a=>{t?(this.productsData=a.data.products,this.getCandlesData(),this.getCandleFilterArray(),this.getCategory(),Promise.all(this.calmSeriesProducts.map(r=>this.getParticularProduct(r))).then(r=>{this.calmSeriesData=r}),Promise.all(this.bestsellers.map(r=>this.getParticularProduct(r))).then(r=>{this.bestsellersData=r})):(this.productsPageStatus="全部產品",this.showProductsData=a.data.products,this.pagination(e)),o(a),this.isLoading=!1}).catch(a=>{i(a)})})},getProducts(t,e=1){this.isLoading=!0;const s=`${u}/v2/api/${g}/products`;return new Promise((o,i)=>{l.get(s,{params:{category:t,page:e}}).then(a=>{this.productPagesData=a.data,this.productsPageStatus=t,this.isLoading=!1,o(a)}).catch(a=>{i(a)})})},pagination(t){const e=this.showProductsData,s=Object.keys(e).length,o=10,i=Math.ceil(s/o);let a=t;a>i&&(a=i);const r=a*o-o+1,c=a*o,d=[];Object.keys(e).forEach((p,m)=>{const h=m+1;h>=r&&h<=c&&d.push(e[p])});const n={total_pages:i,current_page:a,has_pre:a>1,has_next:a<i};this.productPagesData={products:d,pagination:n}},getCategory(){const t=new Set;Object.keys(this.productsData).forEach(e=>{const{category:s}=this.productsData[e];t.add(s)}),this.productsCategory=Array.from(t)},sortPrice(t){let e;t.key&&t.content?e=this.showProductsData:t.category==="全部產品"?e=this.productsData:e=this.productsData.filter(s=>s.category===t.category),t.price==="asc"?e.sort((s,o)=>s.price-o.price):t.price==="desc"&&e.sort((s,o)=>o.price-s.price),this.showProductsData=e,this.pagination(t.page)},getCandlesData(){this.candlesData=this.productsData.filter(t=>t.category==="香氛蠟燭")},getCandleFilterArray(){const t=this.candlesData,e=new Set,s=new Set,o=new Set;t.forEach(i=>{const a=i.title.split("｜");a[2]!==void 0&&a[1]!==void 0&&a[3]!==void 0&&(e.add(a[2]),s.add(a[1]),o.add(a[3]))}),this.uniqueSeriesArray=Array.from(e),this.uniqueTonesArray=Array.from(s),this.uniqueCapacitiesArray=Array.from(o).sort((i,a)=>parseInt(i.replace(/[^0-9]/g,""),10)-parseInt(a.replace(/[^0-9]/g,""),10))},filterCandles(t,e,s=1){this.showProductsData=[],this.productsPageStatus="香氛蠟燭",this.candlesData.forEach(i=>{i.title.split("｜")[t]===e&&this.showProductsData.push(i)}),this.pagination(s)},initializePage(t){t.category==="全部產品"?this.getProductsAll(!1,t.page):t.key&&t.content?this.filterCandles(t.key,t.content,t.page):this.productsCategory.findIndex(s=>s===t.category)!==-1&&this.getProducts(t.category,t.page)},getParticularProduct(t){return new Promise((e,s)=>{const o=()=>{const a=this.productsData.find(r=>r.id===t);a===void 0?s(a):e(a)},i=()=>{this.isLoading?setTimeout(i,100):o()};i()})},async recommendations(t){this.recommendationsData=[];const e={error:null};try{const s=await this.getParticularProduct(t),{title:o}=s,i=o.split("｜")[2],{category:a}=s,r=this.productsData.filter(c=>c.category===a);if(a==="香氛蠟燭"){const d=r.filter(n=>n.title.split("｜")[2]===i).filter(n=>n.id!==t);d.length<4&&this.getParticularProduct("-NoLX8ZL10JiBTlwGN6T").then(n=>{d.push(n),this.recommendationsData=d}),d.length===4&&(this.recommendationsData=d)}if(a==="送禮搭配")for(;this.recommendationsData.length<4;){const c=this.getRandomProduct(r);this.recommendationsData.findIndex(n=>n.id===c.id)===-1&&c.id!==t&&this.recommendationsData.push(c)}if(a==="蠟燭配件")for(;this.recommendationsData.length<4;){let c=this.getRandomProduct(r);this.recommendationsData.length>=r.length-1&&(c=this.getRandomProduct(this.candlesData)),this.recommendationsData.findIndex(n=>n.id===c.id)===-1&&c.id!==t&&this.recommendationsData.push(c)}}catch(s){s===void 0&&(e.error={message:"找不到對應的資料",success:!1})}return e},getRandomProduct(t){const e=Math.floor(Math.random()*t.length);return t[e]},searchProduct(t){const e=[],s=t.toLowerCase();Object.keys(this.productsData).forEach(o=>{this.productsData[o].title.toLowerCase().match(s)&&e.push(this.productsData[o])}),this.showProductsData=e}}});export{_ as p};
