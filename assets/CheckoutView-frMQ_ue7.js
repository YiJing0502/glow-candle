import{_ as x,o as n,c as l,b as e,w,v as M,t as c,e as r,F as N,h as p,a as C,m as E,l as O,f as D,r as P,d as m,g as h,n as y,H as U,k as j}from"./index-b5Mq9qPg.js";import{o as q}from"./ordersStore-2kLE-ddQ.js";import{c as k}from"./cartsStore-l9X8sAeD.js";import{t as L}from"./toastsStore-4YbyuFGs.js";import"./stringStore-LrVTlJvJ.js";import"./timeStore-ZePc6pQ3.js";const R={data(){return{currentNum:1,currentQty:1,serverMessage:{message:"",success:!0}}},props:["inventory","id","qty","productCartId"],emits:["putNum"],methods:{plusNum(){if(this.currentNum=parseInt(this.currentNum,10),this.currentNum>=1&&this.currentNum<this.inventory){this.currentNum+=1,this.$emit("putNum",this.productCartId,this.id,this.currentNum);return}this.currentNum>=this.inventory&&this.showErrMessage("很抱歉，不能超出此庫存量")},minusNum(){if(this.currentNum=parseInt(this.currentNum,10),this.currentNum>1){this.currentNum-=1,this.$emit("putNum",this.productCartId,this.id,this.currentNum);return}this.currentNum<=1&&this.showErrMessage("很抱歉，最低數量為1")},blurNum(t){if(this.currentNum=parseInt(t.target.value,10),this.currentNum>this.inventory){this.currentNum=this.inventory,this.$emit("putNum",this.productCartId,this.id,this.currentNum),this.showErrMessage("很抱歉，不能超出此庫存量");return}if(this.currentNum<=0){this.currentNum=1,this.$emit("putNum",this.productCartId,this.id,this.currentNum),this.showErrMessage("很抱歉，最低數量為1");return}if(this.currentNum!==this.currentQty){if(Number.isNaN(this.currentNum)){this.showErrMessage("請輸入有效的數字"),this.currentNum=this.currentQty;return}this.$emit("putNum",this.productCartId,this.id,this.currentNum)}},showErrMessage(t){this.serverMessage.message=t,this.serverMessage.success=!1,this.$refs.resultModal.openModal()}},watch:{qty(t){this.currentNum=t,this.currentQty=t}},mounted(){this.qty>this.inventory&&this.$emit("putNum",this.productCartId,this.id,this.inventory),this.currentNum=this.qty,this.currentQty=this.qty}},B={class:""},G={class:"bg-white d-flex mb-3 border btns-max-width"},Q=["disabled"],F=["disabled"],z={class:"d-flex align-items-end"};function A(t,s,b,f,a,i){const v=p("ResultModal");return n(),l(N,null,[e("div",B,[e("div",G,[e("button",{disabled:a.currentNum===1,type:"button",class:"btn",onClick:s[0]||(s[0]=(...u)=>i.minusNum&&i.minusNum(...u))},"-",8,Q),w(e("input",{type:"number",class:"form-control border-white shadow-none text-center fw-bold","onUpdate:modelValue":s[1]||(s[1]=u=>a.currentNum=u),onBlur:s[2]||(s[2]=(...u)=>i.blurNum&&i.blurNum(...u))},null,544),[[M,a.currentNum,void 0,{number:!0}]]),e("button",{disabled:a.currentNum===b.inventory,type:"button",class:"btn",onClick:s[3]||(s[3]=(...u)=>i.plusNum&&i.plusNum(...u))}," + ",8,F)]),e("p",z,"目前庫存："+c(b.inventory),1)]),r(v,{ref:"resultModal","server-message":a.serverMessage},null,8,["server-message"])],64)}const H=x(R,[["render",A],["__scopeId","data-v-32460ac5"]]),J={data(){return{useCoupon:!1,couponCode:"",checkOrderInfo:!1,orderData:{data:{user:{name:null,email:null,tel:null,address:null},message:null}},serverMessage:{message:"",success:!0}}},components:{QuantityControlButtons:H},methods:{isPhone(t){return/^(09)[0-9]{8}$/.test(t)?!0:"請輸入正確的行動電話號碼"},async goToGetCart(t=!0){try{await this.getCart(t)}catch(s){this.showErrMessage(s)}},async goToPutCart(t,s,b){try{const f=await this.putCart(t,s,b);await this.goToGetCart(!1),this.pushToast({title:f.data.message,style:"bg-deep-gray"})}catch(f){this.showErrMessage(f)}},async goToDeleteCart(t){try{const s=await this.deleteCart(t);await this.goToGetCart(!1),this.pushToast({title:s.data.message,style:"bg-deep-gray"})}catch(s){this.showErrMessage(s)}},async goToDeleteCarts(){try{const t=await this.deleteCarts();await this.goToGetCart(),this.pushToast({title:t.data.message,style:"bg-deep-gray"})}catch(t){this.showErrMessage(t)}},async goToPostCoupon(){try{const t=await this.postCoupon(this.couponCode);await this.goToGetCart(!1),this.pushToast({title:t.data.message,style:"bg-deep-gray"})}catch(t){this.showErrMessage(t)}},async goToPostOrder(){try{const t=await this.postOrder(this.orderData);this.$router.push({name:"payment",params:{id:t.data.orderId}}),await this.goToGetCart(!1),this.$refs.form.resetForm()}catch(t){this.showErrMessage(t)}},showErrMessage(t){t&&t.response&&t.response.data!==void 0?(this.serverMessage.message=t.response.data.message,this.serverMessage.success=t.response.data.success,this.$refs.resultModal.openModal()):(this.serverMessage.message="未被定義的錯誤",this.serverMessage.success=!1,this.$refs.resultModal.openModal())},...C(k,["getCart","putCart","deleteCart","deleteCarts","postCoupon"]),...C(q,["postOrder"]),...C(L,["pushToast"])},computed:{...E(k,["isLoading","isSmLoading","cartsData","allCartsData"])},mounted(){this.goToGetCart()}},K={key:1,class:"container bg-main-medium container-rounded my-5 py-7r px-lg-5 px-md-4 px-sm-3"},W=e("div",{class:"d-flex align-items-center justify-content-center mb-3"},[e("h2",{class:"text-center border-secondary pb-2 fw-bold"},"結帳")],-1),X={class:"row row-cols-1 row-cols-lg-2"},Y={class:"col"},Z={class:"accordion",id:"accordionPanelsStayOpenExample"},$={class:"accordion-item"},ee=e("h2",{class:"accordion-header",id:"ShoppingCartSection"},[e("button",{class:"accordion-button fs-5 fw-semibold text-deep-gray",type:"button","data-bs-toggle":"collapse","data-bs-target":"#ShoppingCartDetails","aria-expanded":"true","aria-controls":"ShoppingCartDetails"}," 購物車 ")],-1),te={id:"ShoppingCartDetails",class:"accordion-collapse collapse show","aria-labelledby":"ShoppingCartSection"},se={class:"accordion-body"},oe={key:0,class:""},ae=e("p",null,"目前購物車內沒有產品 😄",-1),ne={key:1,class:""},le={class:"col col-sm-2 col-lg-3 d-flex align-items-center justify-content-center"},re=["src","alt"],ie={class:"col col-sm-10 col-lg-9"},de={class:"d-flex justify-content-between"},ce=["onClick"],ue={key:0},me={key:0,class:"d-flex mb-3"},pe={key:0,class:"accordion-item"},he=e("h2",{class:"accordion-header",id:"OrderConfirmationSection"},[e("button",{class:"accordion-button fs-5 fw-semibold collapsed",type:"button","data-bs-toggle":"collapse","data-bs-target":"#OrderConfirmationDetails","aria-expanded":"false","aria-controls":"OrderConfirmationDetails"}," 訂單確認 ")],-1),be={id:"OrderConfirmationDetails",class:"accordion-collapse collapse show","aria-labelledby":"OrderConfirmationSection"},fe={class:"accordion-body"},ge={class:"d-flex justify-content-between"},_e=e("p",null,"產品總金額",-1),ye=e("div",{class:"d-flex justify-content-between"},[e("p",null,"運費"),e("p",null,"免運費")],-1),ve={key:0},Ce={key:0,class:"d-flex justify-content-between"},we=e("p",null,"優惠代碼",-1),Ne={key:1,class:"mb-3"},De=e("p",{class:"w-25"},"優惠代碼",-1),ke={class:"d-flex justify-content-between align-items-center"},xe={key:1,class:"d-flex justify-content-between"},Me=e("p",null,"使用優惠券",-1),Te=e("hr",null,null,-1),Ie={key:2,class:"d-flex justify-content-between"},Se=e("p",null,"總付款金額",-1),Ve={class:"text-end"},Ee={key:3,class:""},Oe={class:"d-flex justify-content-between"},Pe=e("p",null,"總付款金額",-1),Ue={class:"text-decoration-line-through"},je={class:"text-end"},qe={class:"col"},Le={class:"accordion",id:"accordionPanelsStayOpenExample"},Re={key:0,class:"accordion-item"},Be=j('<h2 class="accordion-header" id="ContactUsSection"><button class="accordion-button collapsed fs-5 fw-semibold" type="button" data-bs-toggle="collapse" data-bs-target="#ContactUsDetails" aria-expanded="false" aria-controls="ContactUsDetails"> 聯絡我們 </button></h2><div id="ContactUsDetails" class="accordion-collapse collapse show" aria-labelledby="ContactUsSection"><div class="accordion-body"><div class="d-flex justify-content-between"><p>聯絡信箱</p><p><a class="text-deep-gray" href="mailto:glow.2023@gmail.com">glow.2023@gmail.com </a></p></div><div class="d-flex justify-content-between"><p>聯絡電話</p><p><a class="text-deep-gray" href="tel:0988000999">0988000999</a></p></div><div class="d-flex justify-content-between mb-3"><p>營業時間</p><p>週一至週五 09:00~17:00</p></div><div class="row mb-3"><div class="col d-flex flex-column align-items-center"><span class="material-icons-outlined fs-1 mb-3"> local_shipping </span><span>免費標準配送</span></div><div class="col d-flex flex-column align-items-center"><span class="material-icons-outlined fs-1 mb-3"> redeem </span><span>七日內免費退貨</span></div><div class="col d-flex flex-column align-items-center"><span class="material-icons-outlined fs-1 mb-3"> enhanced_encryption </span><span>安全購物</span></div></div></div></div>',2),Ge=[Be],Qe={key:1,class:"accordion-item"},Fe=e("h2",{class:"accordion-header",id:"RecipientInformationSection"},[e("button",{class:"accordion-button fs-5 fw-semibold",type:"button","data-bs-toggle":"collapse","data-bs-target":"#RecipientInformationDetails","aria-expanded":"true","aria-controls":"RecipientInformationDetails"}," 收件資料 ")],-1),ze={id:"RecipientInformationDetails",class:"accordion-collapse collapse show","aria-labelledby":"RecipientInformationSection"},Ae={class:"accordion-body"},He={class:"mb-3"},Je=e("label",{for:"user",class:"form-label"},[h("收件人名稱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Ke={class:"mb-3"},We=e("label",{for:"email",class:"form-label"},[h("電子信箱 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Xe={class:"mb-3"},Ye=e("label",{for:"phone",class:"form-label"},[h("行動電話號碼 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Ze={class:"mb-3"},$e=e("label",{for:"address",class:"form-label"},[h("收件地址 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),et={class:"mb-3"},tt=e("label",{for:"orderMessage",class:"form-label"},"訂單備註",-1),st={class:"form-check mb-3"},ot=e("label",{for:"is_enabled",class:"form-check-label"},[e("span",{class:"text-main-spec fw-bold"},"我已確認以下內容："),e("span",null,[e("br"),h("提醒您，送出訂單後，將無法修改訂單內容，並前往付款流程，請您確定無誤後再送出😄")])],-1),at=e("div",{class:"bg-light-gray text-deep-gray px-3 py-2 mb-3"},[e("h6",null,"免運服務"),e("span",null,"我們的產品付款採用「線上信用卡」付款後出貨，運送採用「宅配到府」免運服務，讓您輕鬆購買、安心收貨。")],-1),nt={class:"d-flex mb-3"},lt=["disabled"];function rt(t,s,b,f,a,i){const v=p("PageLoading"),u=p("RouterLink"),T=p("VueLoading"),I=p("QuantityControlButtons"),g=p("vee-field"),_=p("vee-error-message"),S=p("vee-form"),V=p("ResultModal");return n(),l(N,null,[t.isLoading?(n(),O(v,{key:0})):(n(),l("div",K,[W,e("div",X,[e("div",Y,[e("div",Z,[e("div",$,[ee,e("div",te,[e("div",se,[t.cartsData.length===0?(n(),l("div",oe,[ae,r(u,{to:{name:"products",query:{category:"全部產品"}},class:"btn btn-solid-spec w-100 btn-lg"},{default:D(()=>[h(" 繼續購物 ")]),_:1})])):(n(),l("div",ne,[(n(!0),l(N,null,P(t.cartsData,o=>(n(),l("div",{class:"row mb-3 position-relative",key:o.id},[r(T,{active:o.product.id===t.isSmLoading||o.id===t.isSmLoading,"is-full-page":!1,color:"#52504B"},null,8,["active"]),e("div",le,[e("img",{src:o.product.imageUrl,alt:o.product.title,class:"img-fluid",width:"150"},null,8,re)]),e("div",ie,[e("div",de,[e("h6",null,c(o.product.title),1),e("button",{type:"button",class:"btn-close","aria-label":"Close",onClick:d=>i.goToDeleteCart(o.id)},null,8,ce)]),e("p",null,[h(" 單價NT$ "+c(parseInt(o.product.price))+" / 小計NT$ "+c(parseInt(o.total))+" ",1),o.final_total!==o.total?(n(),l("span",ue," /優惠價NT$ "+c(parseInt(o.final_total)),1)):m("",!0)]),r(I,{inventory:o.product.inventory,id:o.product_id,qty:o.qty,"product-cart-id":o.id,onPutNum:i.goToPutCart},null,8,["inventory","id","qty","product-cart-id","onPutNum"])])]))),128)),t.cartsData.length>1?(n(),l("div",me,[e("button",{type:"button",class:"btn btn-outline-mdgray w-100",onClick:s[0]||(s[0]=(...o)=>i.goToDeleteCarts&&i.goToDeleteCarts(...o))}," 清空購物車 ")])):m("",!0)]))])])]),t.cartsData.length!==0?(n(),l("div",pe,[he,e("div",be,[e("div",fe,[e("div",ge,[_e,e("p",null,"NT$ "+c(parseInt(t.allCartsData.total)),1)]),ye,t.allCartsData.useCoupon?m("",!0):(n(),l("div",ve,[a.useCoupon?a.useCoupon?(n(),l("div",Ne,[De,e("div",ke,[w(e("input",{type:"text",class:"form-control",id:"category",placeholder:"請填入優惠代碼","onUpdate:modelValue":s[2]||(s[2]=o=>a.couponCode=o)},null,512),[[M,a.couponCode]]),e("button",{type:"button",class:"w-25 btn btn-outline-dpgray ms-3",onClick:s[3]||(s[3]=(...o)=>i.goToPostCoupon&&i.goToPostCoupon(...o))}," 使用 "),e("button",{type:"button",class:"w-25 btn btn-outline-dpgray ms-3",onClick:s[4]||(s[4]=o=>a.useCoupon=!1)}," 取消 ")])])):m("",!0):(n(),l("div",Ce,[we,e("button",{type:"button",class:"btn btn-outline-dpgray",onClick:s[1]||(s[1]=o=>a.useCoupon=!0)}," 使用優惠代碼 ")]))])),t.allCartsData.useCoupon?(n(),l("div",xe,[Me,e("p",null," 優惠 NT$ "+c(parseInt(t.allCartsData.total,10)-parseInt(t.allCartsData.final_total,10)),1)])):m("",!0),Te,t.allCartsData.useCoupon?t.allCartsData.useCoupon?(n(),l("div",Ee,[e("div",Oe,[Pe,e("h5",Ue," NT$ "+c(parseInt(t.allCartsData.total)),1)]),e("h4",je,"NT$ "+c(parseInt(t.allCartsData.final_total)),1)])):m("",!0):(n(),l("div",Ie,[Se,e("h4",Ve,"NT$ "+c(parseInt(t.allCartsData.total)),1)]))])])])):m("",!0)])]),e("div",qe,[e("div",Le,[t.cartsData.length===0?(n(),l("div",Re,Ge)):m("",!0),t.cartsData.length!==0?(n(),l("div",Qe,[Fe,e("div",ze,[e("div",Ae,[r(S,{ref:"form",onSubmit:i.goToPostOrder},{default:D(({errors:o})=>[e("div",He,[Je,r(g,{type:"text",name:"收件人",class:y(["form-control",{"is-invalid":o.收件人}]),rules:"required|max:15",id:"user",placeholder:"請填入收件人真實姓名，以確保順利收件",modelValue:a.orderData.data.user.name,"onUpdate:modelValue":s[5]||(s[5]=d=>a.orderData.data.user.name=d)},null,8,["class","modelValue"]),r(_,{class:"invalid-feedback",name:"收件人"})]),e("div",Ke,[We,r(g,{type:"email",class:y(["form-control",{"is-invalid":o.電子信箱}]),id:"email",rules:"email|required",name:"電子信箱",placeholder:"請填入訂單通知Email (訂單資訊將以此E-mail通知您)",modelValue:a.orderData.data.user.email,"onUpdate:modelValue":s[6]||(s[6]=d=>a.orderData.data.user.email=d)},null,8,["class","modelValue"]),r(_,{class:"invalid-feedback",name:"電子信箱"})]),e("div",Xe,[Ye,r(g,{type:"tel",name:"行動電話",rules:i.isPhone,class:y(["form-control",{"is-invalid":o.行動電話}]),id:"phone",placeholder:"請填入收件人行動電話號碼 (供配送人員聯絡)",modelValue:a.orderData.data.user.tel,"onUpdate:modelValue":s[7]||(s[7]=d=>a.orderData.data.user.tel=d)},null,8,["rules","class","modelValue"]),r(_,{class:"invalid-feedback",name:"行動電話"})]),e("div",Ze,[$e,r(g,{type:"text",name:"收件地址",class:y(["form-control",{"is-invalid":o.收件地址}]),id:"address",rules:"required|max:100",placeholder:"送貨地點目前僅提供：台灣、台灣外島宅配",modelValue:a.orderData.data.user.address,"onUpdate:modelValue":s[8]||(s[8]=d=>a.orderData.data.user.address=d)},null,8,["class","modelValue"]),r(_,{class:"invalid-feedback",name:"收件地址"})]),e("div",et,[tt,r(g,{as:"textarea",name:"訂單備註",class:y(["w-100 form-control",{"is-invalid":o.訂單備註}]),id:"orderMessage",rows:"5",placeholder:"管理室代收/電話聯絡時間...",rules:"max:800",modelValue:a.orderData.data.message,"onUpdate:modelValue":s[9]||(s[9]=d=>a.orderData.data.message=d)},null,8,["class","modelValue"]),r(_,{class:"invalid-feedback",name:"訂單備註"})]),e("div",st,[w(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","onUpdate:modelValue":s[10]||(s[10]=d=>a.checkOrderInfo=d)},null,512),[[U,a.checkOrderInfo]]),ot]),at,e("div",nt,[e("button",{type:"submit",class:"border btn btn-solid-spec w-100 btn-lg",disabled:!a.checkOrderInfo}," 結帳 ",8,lt)])]),_:1},8,["onSubmit"])])])])):m("",!0)])])])])),r(V,{ref:"resultModal","server-message":a.serverMessage},null,8,["server-message"])],64)}const ht=x(J,[["render",rt]]);export{ht as default};
