import{m as x,M as P,_ as k,o as l,c as u,b as e,f as i,g as T,t as r,n as f,w as V,N as I,e as b,i as m,a as w,s as y,F as S,r as N,d as $,J as L,j as J}from"./index-hsfrgDbZ.js";import{t as M}from"./timeStore-HNaeKCH6.js";import{S as B,D as O}from"./StatusMessage-LfNLVKTB.js";import{P as U}from"./PageBtn-Q0UXg0Fu.js";const R={data(){return{modal:"",updatedShowData:{}}},methods:{resetAddForm(){this.$refs.form.resetForm()},openModal(){this.modal.show()},hideModal(){this.modal.hide()},putAdminCoupon(){this.$emit("put-admin-coupon",this.updatedShowData)},postAdminCoupon(){this.$emit("post-admin-coupon",this.updatedShowData)}},computed:{...x(M,["currentDate"])},watch:{showData(){this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},props:["inEditCouponMode","showData"],emits:["put-admin-coupon","post-admin-coupon"],mounted(){this.modal=new P(this.$refs.modal),this.updatedShowData=JSON.parse(JSON.stringify(this.showData))}},F={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true","data-bs-backdrop":"static","data-bs-keyboard":"false"},j={class:"modal-dialog modal-xl"},q={class:"modal-content"},z={class:"modal-header"},G={class:"modal-title fs-5",id:"exampleModalLabel"},H=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),K={class:"modal-body"},Y={class:"row"},Q={class:"col-10"},W={class:"mb-3"},X=e("label",{for:"coupon_title",class:"form-label"},[b("標題 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),Z={class:"col-2 d-flex align-items-center"},ee={class:"form-check mt-3"},te={for:"is_enabled",class:"form-check-label"},oe={key:0,class:"text-main-spec fw-bold"},se={key:1,class:"text-deep-gray"},ae={class:"row"},ne={class:"col mb-3"},de=e("label",{for:"coupon_due_date",class:"form-label"},[b("到期日 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),le={class:"col mb-3"},ie=e("label",{for:"coupon_percent",class:"form-label"},[b("折扣 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ce={class:"col mb-3"},pe=e("label",{for:"coupon_code",class:"form-label"},[b("折扣代碼 "),e("span",{class:"text-main-spec fw-bold"},"*")],-1),ue={class:"modal-footer"},re=e("button",{type:"button",class:"btn btn-normal-dpgray","data-bs-dismiss":"modal"}," 關閉 ",-1),me={type:"submit",class:"btn btn-solid-spec"};function he(s,t,a,n,o,d){const _=m("vee-field"),g=m("vee-error-message"),v=m("vee-form");return l(),u("div",F,[e("div",j,[e("div",q,[i(v,{ref:"form",onSubmit:t[5]||(t[5]=h=>a.inEditCouponMode?d.putAdminCoupon():d.postAdminCoupon())},{default:T(({errors:h})=>[e("div",z,[e("h1",G,r(a.inEditCouponMode?"編輯優惠券":"新增優惠券"),1),H]),e("div",K,[e("div",Y,[e("div",Q,[e("div",W,[X,i(_,{type:"text",name:"標題",class:f(["form-control",{"is-invalid":h.標題}]),rules:"required|max:100",id:"coupon_title",placeholder:"請輸入標題",modelValue:o.updatedShowData.title,"onUpdate:modelValue":t[0]||(t[0]=c=>o.updatedShowData.title=c)},null,8,["class","modelValue"]),i(g,{class:"invalid-feedback",name:"標題"})])]),e("div",Z,[e("div",ee,[V(e("input",{type:"checkbox",class:"form-check-input",id:"is_enabled","true-value":1,"false-value":0,"onUpdate:modelValue":t[1]||(t[1]=c=>o.updatedShowData.is_enabled=c)},null,512),[[I,o.updatedShowData.is_enabled]]),e("label",te,[o.updatedShowData.is_enabled===1?(l(),u("span",oe,"啟用")):(l(),u("span",se,"未啟用"))])])])]),e("div",ae,[e("div",ne,[de,i(_,{type:"date",name:"到期日",class:f(["form-control",{"is-invalid":h.到期日}]),rules:"required",id:"coupon_due_date",placeholder:"請輸入到期日",modelValue:o.updatedShowData.due_date,"onUpdate:modelValue":t[2]||(t[2]=c=>o.updatedShowData.due_date=c),min:s.currentDate},null,8,["class","modelValue","min"]),i(g,{class:"invalid-feedback",name:"到期日"})]),e("div",le,[ie,i(_,{type:"number",name:"折扣",class:f(["form-control",{"is-invalid":h.折扣}]),rules:"required|numeric|integer|min_value:1|max_value:100",id:"coupon_percent",placeholder:"請輸入折扣",modelValue:o.updatedShowData.percent,"onUpdate:modelValue":t[3]||(t[3]=c=>o.updatedShowData.percent=c)},null,8,["class","modelValue"]),i(g,{class:"invalid-feedback",name:"折扣"})]),e("div",ce,[pe,i(_,{type:"text",name:"折扣代碼",class:f(["form-control",{"is-invalid":h.折扣代碼}]),rules:"required|max:100",id:"coupon_code",placeholder:"請輸入折扣代碼",modelValue:o.updatedShowData.code,"onUpdate:modelValue":t[4]||(t[4]=c=>o.updatedShowData.code=c)},null,8,["class","modelValue"]),i(g,{class:"invalid-feedback",name:"折扣代碼"})])])]),e("div",ue,[re,e("button",me,r(a.inEditCouponMode?"更新":"新增"),1)])]),_:1},512)])])],512)}const _e=k(R,[["render",he]]);var ge={VITE_BASE_URL:"https://vue3-course-api.hexschool.io",VITE_API_PATH:"orli-hexschool",VITE_EMAILJS_SERVICE_ID:"service_akj018u",VITE_EMAILJS_TEMPLATE_ID_CONTACT_US:"template_o8blnrh",VITE_EMAILJS_PUBLIC_KEY:"aGG0jyz8scVC5nDvC",BASE_URL:"/glow-candle/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_BASE_URL:C,VITE_API_PATH:D}=ge,be={data(){return{getRemoteData:!1,couponsData:[],pagination:{},showData:{},inEditCouponMode:!0}},components:{StatusMessage:B,DeleteModal:O,CouponModal:_e,PageBtn:U},methods:{getAdminAddCouponModal(){this.inEditCouponMode=!1,this.showData={},this.$refs.couponModal.resetAddForm(),this.$refs.couponModal.openModal()},getAdminCouponModal(s){this.inEditCouponMode=!0,this.showData=JSON.parse(JSON.stringify(this.couponsData[s])),this.showData.due_date=this.timestamp10CodeToDay(this.showData.due_date),this.$refs.couponModal.openModal()},getAdminDeleCouponModal(s){this.showData=JSON.parse(JSON.stringify(this.couponsData[s])),this.$refs.deleteModal.openModal()},goToChangePage(s){this.getAdminCoupons(s)},getAdminCoupons(s=1){const t=s.toString(),a=`${C}/v2/api/${D}/admin/coupons`;this.$http.get(a,{params:{page:t}}).then(n=>{this.getRemoteData=n.data.success,this.couponsData=n.data.coupons,this.pagination=n.data.pagination}).catch(n=>{this.showAlertMessage(!1,n.response.data.message)})},postAdminCoupon(s){const t=`${C}/v2/api/${D}/admin/coupon`,a={data:s};a.data.due_date=this.dayToTimestamp10Code(s.due_date),a.data.is_enabled===void 0&&(a.data.is_enabled=2),this.$http.post(t,a).then(n=>{this.getAdminCoupons(),this.$refs.couponModal.hideModal(),this.pushToast({title:n.data.message,style:"bg-deep-gray"})}).catch(n=>{this.showAlertMessage(!1,n.response.data.message)})},putAdminCoupon(s){const{id:t}=s,a=`${C}/v2/api/${D}/admin/coupon/${t}`,n={data:s};n.data.due_date=this.dayToTimestamp10Code(s.due_date),this.$http.put(a,n).then(o=>{this.getAdminCoupons(),this.$refs.couponModal.hideModal(),this.pushToast({title:o.data.message,style:"bg-deep-gray"})}).catch(o=>{this.showAlertMessage(!1,o.response.data.message)})},deleteAdminCoupon(){const{id:s}=this.showData,t=`${C}/v2/api/${D}/admin/coupon/${s}`;this.$http.delete(t).then(a=>{this.getAdminCoupons(),this.$refs.deleteModal.hideModal(),this.pushToast({title:a.data.message,style:"bg-deep-gray"})}).catch(a=>{this.showAlertMessage(!1,a.response.data.message)})},couponsDueDateMessage(s){const t=this.dayToTimestamp10Code(this.currentDate),a=this.timestamp10CodeToDay(s);return s<t?`${a} (已過期)`:s>t?`${a}`:`${a} (今天過期)`},...w(M,["dayToTimestamp10Code","timestamp10CodeToDay"]),...w(L,["pushToast"]),...w(J,["showAlertMessage"])},computed:{...x(M,["currentDate"])},mounted(){this.getAdminCoupons()}},fe={key:1,class:"container"},Ce={class:"row mt-4"},De={class:"col d-flex justify-content-end"},ve={key:1,class:"table mt-4 align-middle"},we=e("thead",null,[e("tr",null,[e("th",{scope:"col"},"#"),e("th",{scope:"col"},"優惠券名稱"),e("th",{scope:"col"},"折扣"),e("th",{scope:"col"},"到期日"),e("th",{scope:"col"},"代碼"),e("th",{scope:"col"},"是否啟用"),e("th",{scope:"col"},"操作")])],-1),Me={key:0,class:"text-main-spec fw-bold"},Ae={key:1,class:"text-deep-gray"},ye=["onClick"],Se=["onClick"],xe={key:2,class:"d-flex justify-content-center mt-4"},ke={"aria-label":"Page navigation example"},Te={class:"pagination",id:"pageid"};function Ee(s,t,a,n,o,d){const _=m("PageLoading"),g=m("status-message"),v=m("PageBtn"),h=m("CouponModal"),c=m("DeleteModal");return l(),u(S,null,[o.getRemoteData?(l(),u("div",fe,[e("div",Ce,[e("div",De,[e("button",{type:"button",class:"btn btn-solid-spec",onClick:t[0]||(t[0]=(...p)=>d.getAdminAddCouponModal&&d.getAdminAddCouponModal(...p))}," 建立新的優惠券 ")])]),o.couponsData.length===0?(l(),y(g,{key:0},{default:T(()=>[b(r("請點擊「建立新的優惠券」新增資料"))]),_:1})):(l(),u("table",ve,[we,e("tbody",null,[(l(!0),u(S,null,N(o.couponsData,(p,A)=>(l(),u("tr",{key:p.id},[e("th",null,r(p.num),1),e("th",null,r(p.title),1),e("td",null,r(p.percent),1),e("td",null,r(d.couponsDueDateMessage(p.due_date)),1),e("td",null,r(p.code),1),e("td",null,[p.is_enabled===1?(l(),u("span",Me,"啟用")):(l(),u("span",Ae,"未啟用"))]),e("td",null,[e("button",{type:"button",class:"btn btn-sm btn-normal-medium block w-50",onClick:E=>d.getAdminDeleCouponModal(A)}," 刪除 ",8,ye),e("button",{type:"button",class:"btn btn-sm btn-normal-medium block w-50",onClick:E=>d.getAdminCouponModal(A)}," 編輯 ",8,Se)])]))),128))])])),o.pagination&&o.pagination.current_page?(l(),u("div",xe,[e("nav",ke,[e("ul",Te,[i(v,{"prev-is-enabled":o.pagination.has_pre,"next-is-enabled":o.pagination.has_next,totalPage:o.pagination.total_pages,"current-page":o.pagination.current_page,onChangePrevPage:t[1]||(t[1]=p=>d.getAdminCoupons(o.pagination.current_page-1)),onChangeNextPage:t[2]||(t[2]=p=>d.getAdminCoupons(o.pagination.current_page+1)),onChangePage:d.goToChangePage},null,8,["prev-is-enabled","next-is-enabled","totalPage","current-page","onChangePage"])])])])):$("",!0)])):(l(),y(_,{key:0})),i(h,{ref:"couponModal","in-edit-coupon-mode":o.inEditCouponMode,"show-data":o.showData,onPostAdminCoupon:d.postAdminCoupon,onPutAdminCoupon:d.putAdminCoupon},null,8,["in-edit-coupon-mode","show-data","onPostAdminCoupon","onPutAdminCoupon"]),i(c,{ref:"deleteModal","show-data":o.showData,onDeleteFunction:d.deleteAdminCoupon},null,8,["show-data","onDeleteFunction"])],64)}const $e=k(be,[["render",Ee]]);export{$e as default};
