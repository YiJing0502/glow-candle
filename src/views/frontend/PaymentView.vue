<template>
  <VueLoading
    v-if="isLoading"
    :active="isLoading"
    :background-color="'#EBEAE4'"
    :is-full-page="true"
    :color="'#52504B'"
  />
  <div v-else class="container bg-main-medium container-rounded my-5 py-7r px-lg-5 px-md-4 px-sm-3">
    <!-- å¤§æ¨™é¡Œ -->
    <div class="d-flex align-items-center justify-content-center mb-3">
      <h2 v-if="!showData.is_paid" class="text-center border-secondary pb-2 fw-bold">
        è¨‚å–®å·²å»ºç«‹ï¼
      </h2>
      <h2 v-else class="text-center border-secondary pb-2 fw-bold">è¨‚è³¼å®Œæˆï¼</h2>
    </div>
    <!-- è©³ç´°å…§å®¹ -->
    <div class="row row-cols-1 row-cols-lg-2">
      <!-- è©³ç´°å…§å®¹å·¦ -->
      <div class="col">
        <div class="accordion">
          <!-- è¨‚å–®è³‡è¨Š -->
          <div class="accordion-item">
            <!-- OrderInformationSection -->
            <h2 class="accordion-header" id="OrderInformationSection">
              <button
                class="accordion-button collapsed fs-5 fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#OrderInformationDetails"
                aria-expanded="false"
                aria-controls="OrderInformationDetails"
              >
                è¨‚å–®è³‡è¨Š
              </button>
            </h2>
            <!-- OrderInformationDetails -->
            <div
              id="OrderInformationDetails"
              class="accordion-collapse collapse show"
              aria-labelledby="OrderInformationSection"
            >
              <div class="accordion-body">
                <!-- è¨‚å–®ç·¨è™Ÿ -->
                <div class="d-flex justify-content-between">
                  <p>è¨‚å–®ç·¨è™Ÿ</p>
                  <p>{{ showData.id }}</p>
                </div>
                <!-- å»ºç«‹æ™‚é–“ -->
                <div class="d-flex justify-content-between">
                  <p>å»ºç«‹æ™‚é–“</p>
                  <p>{{ showData.create_at }}</p>
                </div>
                <!-- ç¸½é‡‘é¡ -->
                <div class="d-flex justify-content-between">
                  <p>ç¸½é‡‘é¡</p>
                  <p>NT$ {{ parseInt(showData.total) }}</p>
                </div>
                <div v-if="!showData.is_paid" class="bg-medium-gray text-deep-gray px-3 py-2 mb-3">
                  <h6>ä¿®æ”¹è¨‚å–®å•é¡Œï¼Ÿ</h6>
                  <span
                    >è‹¥æ‚¨æ–¼å·²ä¸‹å–®å¾Œæƒ³ä¿®æ”¹æ‚¨çš„è¨‚å–®ï¼Œè«‹æ‚¨å…ˆä¸è¦ä»˜æ¬¾ï¼Œè«‹å…ˆè¯çµ¡å®¢æœäººå“¡ä¿®æ”¹æ‚¨çš„è¨‚å–®å¾Œï¼Œå†æœå°‹æ‚¨çš„è¨‚å–®å‰å¾€ä»˜æ¬¾ğŸ˜„</span
                  >
                </div>
                <div v-else class="bg-medium-gray text-deep-gray px-3 py-2 mb-3">
                  <h6>åˆ°è²¨æ™‚é–“ï¼Ÿ</h6>
                  <span
                    >åœ¨ç¢ºèªæ”¶åˆ°æ‚¨è¨‚å–®å’Œæ¬¾é …ä¹‹å¾Œæˆ‘å€‘ç´„æœ‰1~2å¤©å‚™è²¨æœŸï¼Œæ‚¨æœ€å¤šå¯ä»¥æŒ‡å®š3å¤©å¾Œä½œç‚ºé æœŸæ”¶åˆ°è²¨çš„æ—¥æœŸã€‚
                    å¯¦éš›ä¾ç…§ç¶²ç«™å‡ºè²¨åŠç‰©æµæ¥­è€…çš„é…é€æ™‚é–“ç‚ºæº–ã€‚</span
                  >
                </div>
                <!-- é»æˆ‘ä»˜æ¬¾æŒ‰éˆ• -->
                <div v-if="!showData.is_paid" class="d-flex mb-3">
                  <button
                    type="button"
                    class="btn btn-solid-spec w-100 btn-lg"
                    @click="goToPostPayOrder(showData.id)"
                  >
                    é»æˆ‘ä»˜æ¬¾
                  </button>
                </div>
                <div v-else class="d-flex mb-3">
                  <button
                    type="button"
                    class="btn btn-solid-dpgray w-100 btn-lg"
                    @click="goToOrderDetailPage(showData.id)"
                  >
                    é»æ“ŠæŸ¥çœ‹æ­¤ç­†è¨‚å–®
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!-- è©³ç´°å…§å®¹å³ -->
      <div class="col">
        <div class="accordion">
          <!-- è¯çµ¡æˆ‘å€‘ -->
          <div class="accordion-item">
            <!-- ContactUsSection -->
            <h2 class="accordion-header" id="ContactUsSection">
              <button
                class="accordion-button collapsed fs-5 fw-semibold"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#ContactUsDetails"
                aria-expanded="false"
                aria-controls="ContactUsDetails"
              >
                è¯çµ¡æˆ‘å€‘
              </button>
            </h2>
            <!-- ContactUsDetails -->
            <div
              id="ContactUsDetails"
              class="accordion-collapse collapse show"
              aria-labelledby="ContactUsSection"
            >
              <div class="accordion-body">
                <!-- è¯çµ¡ä¿¡ç®± -->
                <div class="d-flex justify-content-between">
                  <p>è¯çµ¡ä¿¡ç®±</p>
                  <p>glow.2023@gmail.com</p>
                </div>
                <!-- è¯çµ¡é›»è©± -->
                <div class="d-flex justify-content-between">
                  <p>è¯çµ¡é›»è©±</p>
                  <p>0988000999</p>
                </div>
                <!-- ç‡Ÿæ¥­æ™‚é–“ -->
                <div class="d-flex justify-content-between mb-3">
                  <p>ç‡Ÿæ¥­æ™‚é–“</p>
                  <p>é€±ä¸€è‡³é€±äº” 09:00~17:00</p>
                </div>
                <!-- è³¼ç‰©ä¿è­‰ -->
                <div class="row mb-3">
                  <div class="col d-flex flex-column align-items-center">
                    <span class="material-icons-outlined fs-1 mb-3"> local_shipping </span>
                    <span>å…è²»æ¨™æº–é…é€</span>
                  </div>
                  <div class="col d-flex flex-column align-items-center">
                    <span class="material-icons-outlined fs-1 mb-3"> redeem </span>
                    <span>ä¸ƒæ—¥å…§å…è²»é€€è²¨</span>
                  </div>
                  <div class="col d-flex flex-column align-items-center">
                    <span class="material-icons-outlined fs-1 mb-3"> enhanced_encryption </span>
                    <span>å®‰å…¨è³¼ç‰©</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <ResultModal ref="resultModal" :server-message="serverMessage"></ResultModal>
</template>
<script>
import { mapActions, mapState } from 'pinia';
import ordersStore from '../../stores/ordersStore';

export default {
  data() {
    return {
      // result model
      serverMessage: {
        message: '',
        success: true,
      },
    };
  },
  methods: {
    async goToGetOrder() {
      try {
        const res = await this.getOrder(this.$route.params.id);
        if (res.data.order === null) {
          this.$router.push({
            name: 'front404',
            params: { pathMatch: this.$route.path.split('/').slice(1) },
            query: this.$route.query,
            hash: this.$route.hash,
          });
        }
        if (!res.data.order.is_paid) {
          this.serverMessage.message = 'è¨‚å–®å·²å»ºç«‹ï¼Œè«‹é»æ“Šä»˜æ¬¾æŒ‰éˆ•ä»˜æ¬¾';
          this.serverMessage.success = res.data.success;
          this.$refs.resultModal.openModal();
        }
      } catch (err) {
        this.serverMessage.message = err.response.data.message;
        this.serverMessage.success = err.response.data.success;
        this.$refs.resultModal.openModal();
      }
    },
    async goToPostPayOrder(orderId) {
      try {
        const res = await this.postPayOrder(orderId);
        await this.goToGetOrder();
        this.serverMessage = res.data;
        this.$refs.resultModal.openModal();
      } catch (err) {
        this.serverMessage.message = err.response.data.message;
        this.serverMessage.success = err.response.data.success;
        this.$refs.resultModal.openModal();
      }
    },
    goToOrderDetailPage(orderId) {
      this.$router.push({
        name: 'order',
        params: {
          id: orderId,
        },
      });
    },
    ...mapActions(ordersStore, ['getOrder', 'postPayOrder', 'changeToIdPage']),
  },
  computed: {
    ...mapState(ordersStore, ['isLoading', 'showData']),
  },
  mounted() {
    this.goToGetOrder();
  },
};
</script>
